{
  "cache_key": "commons-csv_7bfb0ceaf708a649becb319a06a2d7f8e5022e9b_method",
  "cached_at": "2026-01-25T17:58:34.905162",
  "project": "commons-csv",
  "commit_hash": "7bfb0ceaf708a649becb319a06a2d7f8e5022e9b",
  "phase": "method",
  "data": {
    "commit_hash": "7bfb0ceaf708a649becb319a06a2d7f8e5022e9b",
    "parent_hash": "7b4e1059ab87e29dc93e104d9ea2b4f5e002f1eb",
    "basic_info": {
      "project": "commons-csv",
      "commit_hash": "7bfb0ceaf708a649becb319a06a2d7f8e5022e9b",
      "short_hash": "7bfb0cea",
      "parent_hash": "7b4e1059ab87e29dc93e104d9ea2b4f5e002f1eb",
      "parent_short_hash": "7b4e1059",
      "author": "Gary Gregory",
      "date": "2025-03-08 16:49:24",
      "message": "CSVParser.getRecords() knows how to use CSVFormat's maxRows\n\nCSVParser.stream() knows how to use CSVFormat's maxRows",
      "message_subject": "CSVParser.getRecords() knows how to use CSVFormat's maxRows"
    },
    "file_changes": {
      "source_files": [
        {
          "path": "src/main/java/org/apache/commons/csv/CSVFormat.java",
          "change_type": "modified",
          "old_path": null,
          "is_java": true
        },
        {
          "path": "src/main/java/org/apache/commons/csv/CSVParser.java",
          "change_type": "modified",
          "old_path": null,
          "is_java": true
        },
        {
          "path": "src/main/java/org/apache/commons/csv/CSVPrinter.java",
          "change_type": "modified",
          "old_path": null,
          "is_java": true
        }
      ],
      "test_files": [
        {
          "path": "src/test/java/org/apache/commons/csv/CSVParserTest.java",
          "change_type": "modified",
          "old_path": null,
          "is_java": true
        },
        {
          "path": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
          "change_type": "modified",
          "old_path": null,
          "is_java": true
        }
      ],
      "other_files": [
        {
          "path": "src/changes/changes.xml",
          "change_type": "modified",
          "old_path": null,
          "is_java": false
        }
      ],
      "summary": {
        "total_files": 6,
        "source_count": 3,
        "test_count": 2,
        "other_count": 1
      }
    },
    "method_changes": {
      "source_methods": [
        {
          "class": "CSVFormat",
          "method": "limit",
          "parameters": [
            "IOStream"
          ],
          "start_line": 2093,
          "end_line": 2095,
          "package": "org.apache.commons.csv",
          "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
          "return_type": null,
          "modifiers": []
        },
        {
          "class": "CSVFormat",
          "method": "limit",
          "parameters": [
            "Stream"
          ],
          "start_line": 2097,
          "end_line": 2099,
          "package": "org.apache.commons.csv",
          "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
          "return_type": null,
          "modifiers": []
        },
        {
          "class": "CSVParser",
          "method": "stream",
          "parameters": [],
          "start_line": 940,
          "end_line": 942,
          "package": "org.apache.commons.csv",
          "file": "src/main/java/org/apache/commons/csv/CSVParser.java",
          "return_type": null,
          "modifiers": []
        },
        {
          "class": "CSVPrinter",
          "method": "printRecords",
          "parameters": [
            "IOStream"
          ],
          "start_line": 347,
          "end_line": 349,
          "package": "org.apache.commons.csv",
          "file": "src/main/java/org/apache/commons/csv/CSVPrinter.java",
          "return_type": null,
          "modifiers": []
        }
      ],
      "test_methods": [
        {
          "class": "CSVParserTest",
          "method": "testGetRecordsMaxRows",
          "parameters": [
            "long"
          ],
          "start_line": 893,
          "end_line": 903,
          "package": "org.apache.commons.csv",
          "file": "src/test/java/org/apache/commons/csv/CSVParserTest.java",
          "return_type": null,
          "modifiers": [],
          "is_test_method": true
        },
        {
          "class": "CSVParserTest",
          "method": "testStreamMaxRows",
          "parameters": [
            "long"
          ],
          "start_line": 1676,
          "end_line": 1689,
          "package": "org.apache.commons.csv",
          "file": "src/test/java/org/apache/commons/csv/CSVParserTest.java",
          "return_type": null,
          "modifiers": [],
          "is_test_method": true
        },
        {
          "class": "CSVPrinterTest",
          "method": "testJdbcPrinterWithResultSet",
          "parameters": [
            "long"
          ],
          "start_line": 844,
          "end_line": 868,
          "package": "org.apache.commons.csv",
          "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
          "return_type": null,
          "modifiers": [],
          "is_test_method": true
        },
        {
          "class": "CSVPrinterTest",
          "method": "testJdbcPrinterWithResultSetHeader",
          "parameters": [
            "long"
          ],
          "start_line": 872,
          "end_line": 893,
          "package": "org.apache.commons.csv",
          "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
          "return_type": null,
          "modifiers": [],
          "is_test_method": true
        }
      ],
      "summary": {
        "source_methods_count": 4,
        "test_methods_count": 4
      }
    },
    "diff_info": {
      "full_diff": "diff --git a/src/changes/changes.xml b/src/changes/changes.xml\nindex 4898ae8e..80a6edd6 100644\n--- a/src/changes/changes.xml\n+++ b/src/changes/changes.xml\n@@ -51,6 +51,8 @@\n       <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVPrinter.printRecords(ResultSet) knows how to use CSVFormat's maxRows.</action>\n       <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVPrinter.printRecords(Iterable) knows how to use CSVFormat's maxRows.</action>\n       <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVPrinter.printRecords(Stream) knows how to use CSVFormat's maxRows.</action>\n+      <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVParser.stream() knows how to use CSVFormat's maxRows.</action>\n+      <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVParser.getRecords() knows how to use CSVFormat's maxRows.</action>\n       <!-- UPDATE -->\n       <action type=\"update\" dev=\"ggregory\" due-to=\"Gary Gregory\">Bump com.opencsv:opencsv from 5.9 to 5.10.</action>\n       <action type=\"update\" dev=\"ggregory\" due-to=\"Gary Gregory\">Bump commons-codec:commons-codec from 1.17.2 to 1.18.0 #522.</action>\ndiff --git a/src/main/java/org/apache/commons/csv/CSVFormat.java b/src/main/java/org/apache/commons/csv/CSVFormat.java\nindex 1db9b595..5f8c76ea 100644\n--- a/src/main/java/org/apache/commons/csv/CSVFormat.java\n+++ b/src/main/java/org/apache/commons/csv/CSVFormat.java\n@@ -40,9 +40,11 @@ import java.util.HashSet;\n import java.util.Objects;\n import java.util.Set;\n import java.util.function.Supplier;\n+import java.util.stream.Stream;\n \n import org.apache.commons.codec.binary.Base64OutputStream;\n import org.apache.commons.io.IOUtils;\n+import org.apache.commons.io.function.IOStream;\n import org.apache.commons.io.function.Uncheck;\n import org.apache.commons.io.output.AppendableOutputStream;\n \n@@ -2088,6 +2090,14 @@ public final class CSVFormat implements Serializable {\n         return quoteCharacter != null;\n     }\n \n+    <T> IOStream<T> limit(final IOStream<T> stream) {\n+        return getMaxRows() > 0 ? stream.limit(getMaxRows()) : stream;\n+    }\n+\n+    <T> Stream<T> limit(final Stream<T> stream) {\n+        return getMaxRows() > 0 ? stream.limit(getMaxRows()) : stream;\n+    }\n+\n     /**\n      * Parses the specified content.\n      *\n@@ -3178,4 +3188,5 @@ public final class CSVFormat implements Serializable {\n     public CSVFormat withTrim(final boolean trim) {\n         return builder().setTrim(trim).get();\n     }\n+\n }\ndiff --git a/src/main/java/org/apache/commons/csv/CSVParser.java b/src/main/java/org/apache/commons/csv/CSVParser.java\nindex 1c88d9c7..0cd37c9a 100644\n--- a/src/main/java/org/apache/commons/csv/CSVParser.java\n+++ b/src/main/java/org/apache/commons/csv/CSVParser.java\n@@ -938,7 +938,7 @@ public final class CSVParser implements Iterable<CSVRecord>, Closeable {\n      * @since 1.9.0\n      */\n     public Stream<CSVRecord> stream() {\n-        return StreamSupport.stream(Spliterators.spliteratorUnknownSize(iterator(), Spliterator.ORDERED), false);\n+        return format.limit(StreamSupport.stream(Spliterators.spliteratorUnknownSize(iterator(), Spliterator.ORDERED), false));\n     }\n \n }\ndiff --git a/src/main/java/org/apache/commons/csv/CSVPrinter.java b/src/main/java/org/apache/commons/csv/CSVPrinter.java\nindex 7c17d1e7..ec0b8f1d 100644\n--- a/src/main/java/org/apache/commons/csv/CSVPrinter.java\n+++ b/src/main/java/org/apache/commons/csv/CSVPrinter.java\n@@ -345,7 +345,7 @@ public final class CSVPrinter implements Flushable, Closeable {\n \n     @SuppressWarnings(\"resource\")\n     private void printRecords(final IOStream<?> stream) throws IOException {\n-        (format.getMaxRows() > 0 ? stream.limit(format.getMaxRows()) : stream).forEachOrdered(this::printRecordObject);\n+        format.limit(stream).forEachOrdered(this::printRecordObject);\n     }\n \n     /**\ndiff --git a/src/test/java/org/apache/commons/csv/CSVParserTest.java b/src/test/java/org/apache/commons/csv/CSVParserTest.java\nindex 59a1dd6e..50bf052b 100644\n--- a/src/test/java/org/apache/commons/csv/CSVParserTest.java\n+++ b/src/test/java/org/apache/commons/csv/CSVParserTest.java\n@@ -62,6 +62,7 @@ import org.junit.jupiter.api.Disabled;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.params.ParameterizedTest;\n import org.junit.jupiter.params.provider.EnumSource;\n+import org.junit.jupiter.params.provider.ValueSource;\n \n /**\n  * CSVParserTest\n@@ -887,6 +888,20 @@ public class CSVParserTest {\n \n     }\n \n+    @ParameterizedTest\n+    @ValueSource(longs = { -1, 0, 1, 2, 3, 4, Long.MAX_VALUE })\n+    public void testGetRecordsMaxRows(final long maxRows) throws IOException {\n+        try (CSVParser parser = CSVParser.parse(CSV_INPUT, CSVFormat.DEFAULT.builder().setIgnoreSurroundingSpaces(true).setMaxRows(maxRows).get())) {\n+            final List<CSVRecord> records = parser.getRecords();\n+            final long expectedLength = maxRows <= 0 || maxRows > RESULT.length ? RESULT.length : maxRows;\n+            assertEquals(expectedLength, records.size());\n+            assertFalse(records.isEmpty());\n+            for (int i = 0; i < expectedLength; i++) {\n+                assertArrayEquals(RESULT[i], records.get(i).values());\n+            }\n+        }\n+    }\n+\n     @Test\n     public void testGetRecordThreeBytesRead() throws Exception {\n         final String code = \"id,date,val5,val4\\n\" +\n@@ -1656,6 +1671,23 @@ public class CSVParserTest {\n         }\n     }\n \n+    @ParameterizedTest\n+    @ValueSource(longs = { -1, 0, 1, 2, 3, 4, Long.MAX_VALUE })\n+    public void testStreamMaxRows(final long maxRows) throws Exception {\n+        final Reader in = new StringReader(\"a,b,c\\n1,2,3\\nx,y,z\");\n+        try (CSVParser parser = CSVFormat.DEFAULT.builder().setMaxRows(maxRows).get().parse(in)) {\n+            final List<CSVRecord> list = parser.stream().collect(Collectors.toList());\n+            assertFalse(list.isEmpty());\n+            assertArrayEquals(new String[] { \"a\", \"b\", \"c\" }, list.get(0).values());\n+            if (maxRows <= 0 || maxRows > 1) {\n+                assertArrayEquals(new String[] { \"1\", \"2\", \"3\" }, list.get(1).values());\n+            }\n+            if (maxRows <= 0 || maxRows > 2) {\n+                assertArrayEquals(new String[] { \"x\", \"y\", \"z\" }, list.get(2).values());\n+            }\n+        }\n+    }\n+\n     @Test\n     public void testThrowExceptionWithLineAndPosition() throws IOException {\n         final String csvContent = \"col1,col2,col3,col4,col5,col6,col7,col8,col9,col10\\nrec1,rec2,rec3,rec4,rec5,rec6,rec7,rec8,\\\"\\\"rec9\\\"\\\",rec10\";\ndiff --git a/src/test/java/org/apache/commons/csv/CSVPrinterTest.java b/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\nindex 36542b99..a1a59cf4 100644\n--- a/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\n+++ b/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\n@@ -710,7 +710,7 @@ public class CSVPrinterTest {\n     }\n \n     @ParameterizedTest\n-    @ValueSource(longs = { -1, 0, 1, 2, Integer.MAX_VALUE })\n+    @ValueSource(longs = { -1, 0, 1, 2, Long.MAX_VALUE })\n     public void testExcelPrintAllStreamOfArrays(final long maxRows) throws IOException {\n         final StringWriter sw = new StringWriter();\n         final CSVFormat format = CSVFormat.EXCEL.builder().setMaxRows(maxRows).get();\n@@ -840,7 +840,7 @@ public class CSVPrinterTest {\n     }\n \n     @ParameterizedTest\n-    @ValueSource(longs = { -1, 0, 1, 2, 3, 4, Integer.MAX_VALUE })\n+    @ValueSource(longs = { -1, 0, 1, 2, 3, 4, Long.MAX_VALUE })\n     public void testJdbcPrinterWithResultSet(final long maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n         final CSVFormat format = CSVFormat.DEFAULT.builder().setMaxRows(maxRows).get();\n@@ -864,11 +864,11 @@ public class CSVPrinterTest {\n             assertEquals(allRows, resultString);\n             expectedRowsWithHeader = TABLE_AND_HEADER_RECORD_COUNT;\n         }\n-        assertRowCount(format, resultString, expectedRowsWithHeader);\n+        assertRowCount(CSVFormat.DEFAULT, resultString, expectedRowsWithHeader);\n     }\n \n     @ParameterizedTest\n-    @ValueSource(longs = { -1, 0, 3, 4, Integer.MAX_VALUE })\n+    @ValueSource(longs = { -1, 0, 3, 4, Long.MAX_VALUE })\n     public void testJdbcPrinterWithResultSetHeader(final long maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n         try (Connection connection = getH2Connection()) {\n@@ -887,13 +887,13 @@ public class CSVPrinterTest {\n                     assertEquals(TABLE_RECORD_COUNT * 2, printer.getRecordCount());\n                     assertNotEquals(\"ID,NAME\" + RECORD_SEPARATOR + \"1,r1\" + RECORD_SEPARATOR + \"2,r2\" + RECORD_SEPARATOR, sw.toString());\n                 }\n-                assertRowCount(format, sw.toString(), TABLE_AND_HEADER_RECORD_COUNT + TABLE_RECORD_COUNT);\n+                assertRowCount(CSVFormat.DEFAULT, sw.toString(), TABLE_AND_HEADER_RECORD_COUNT + TABLE_RECORD_COUNT);\n             }\n         }\n     }\n \n     @ParameterizedTest\n-    @ValueSource(longs = { -1, 0, 3, 4, Integer.MAX_VALUE })\n+    @ValueSource(longs = { -1, 0, 3, 4, Long.MAX_VALUE })\n     public void testJdbcPrinterWithResultSetMetaData(final long maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n         try (Connection connection = getH2Connection()) {\n@@ -1509,7 +1509,7 @@ public class CSVPrinterTest {\n     }\n \n     @ParameterizedTest\n-    @ValueSource(longs = { -1, 0, 3, 4, Integer.MAX_VALUE })\n+    @ValueSource(longs = { -1, 0, 3, 4, Long.MAX_VALUE })\n     public void testPrintCSVRecords(final long maxRows) throws IOException {\n         // @formatter:off\n         final String code = \"a1,b1\\n\" + // 1)",
      "source_only_diff": "diff --git a/src/changes/changes.xml b/src/changes/changes.xml\nindex 4898ae8e..80a6edd6 100644\n--- a/src/changes/changes.xml\n+++ b/src/changes/changes.xml\n@@ -51,6 +51,8 @@\n       <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVPrinter.printRecords(ResultSet) knows how to use CSVFormat's maxRows.</action>\n       <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVPrinter.printRecords(Iterable) knows how to use CSVFormat's maxRows.</action>\n       <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVPrinter.printRecords(Stream) knows how to use CSVFormat's maxRows.</action>\n+      <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVParser.stream() knows how to use CSVFormat's maxRows.</action>\n+      <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVParser.getRecords() knows how to use CSVFormat's maxRows.</action>\n       <!-- UPDATE -->\n       <action type=\"update\" dev=\"ggregory\" due-to=\"Gary Gregory\">Bump com.opencsv:opencsv from 5.9 to 5.10.</action>\n       <action type=\"update\" dev=\"ggregory\" due-to=\"Gary Gregory\">Bump commons-codec:commons-codec from 1.17.2 to 1.18.0 #522.</action>\n\ndiff --git a/src/main/java/org/apache/commons/csv/CSVFormat.java b/src/main/java/org/apache/commons/csv/CSVFormat.java\nindex 1db9b595..5f8c76ea 100644\n--- a/src/main/java/org/apache/commons/csv/CSVFormat.java\n+++ b/src/main/java/org/apache/commons/csv/CSVFormat.java\n@@ -40,9 +40,11 @@ import java.util.HashSet;\n import java.util.Objects;\n import java.util.Set;\n import java.util.function.Supplier;\n+import java.util.stream.Stream;\n \n import org.apache.commons.codec.binary.Base64OutputStream;\n import org.apache.commons.io.IOUtils;\n+import org.apache.commons.io.function.IOStream;\n import org.apache.commons.io.function.Uncheck;\n import org.apache.commons.io.output.AppendableOutputStream;\n \n@@ -2088,6 +2090,14 @@ public final class CSVFormat implements Serializable {\n         return quoteCharacter != null;\n     }\n \n+    <T> IOStream<T> limit(final IOStream<T> stream) {\n+        return getMaxRows() > 0 ? stream.limit(getMaxRows()) : stream;\n+    }\n+\n+    <T> Stream<T> limit(final Stream<T> stream) {\n+        return getMaxRows() > 0 ? stream.limit(getMaxRows()) : stream;\n+    }\n+\n     /**\n      * Parses the specified content.\n      *\n@@ -3178,4 +3188,5 @@ public final class CSVFormat implements Serializable {\n     public CSVFormat withTrim(final boolean trim) {\n         return builder().setTrim(trim).get();\n     }\n+\n }\n\ndiff --git a/src/main/java/org/apache/commons/csv/CSVParser.java b/src/main/java/org/apache/commons/csv/CSVParser.java\nindex 1c88d9c7..0cd37c9a 100644\n--- a/src/main/java/org/apache/commons/csv/CSVParser.java\n+++ b/src/main/java/org/apache/commons/csv/CSVParser.java\n@@ -938,7 +938,7 @@ public final class CSVParser implements Iterable<CSVRecord>, Closeable {\n      * @since 1.9.0\n      */\n     public Stream<CSVRecord> stream() {\n-        return StreamSupport.stream(Spliterators.spliteratorUnknownSize(iterator(), Spliterator.ORDERED), false);\n+        return format.limit(StreamSupport.stream(Spliterators.spliteratorUnknownSize(iterator(), Spliterator.ORDERED), false));\n     }\n \n }\n\ndiff --git a/src/main/java/org/apache/commons/csv/CSVPrinter.java b/src/main/java/org/apache/commons/csv/CSVPrinter.java\nindex 7c17d1e7..ec0b8f1d 100644\n--- a/src/main/java/org/apache/commons/csv/CSVPrinter.java\n+++ b/src/main/java/org/apache/commons/csv/CSVPrinter.java\n@@ -345,7 +345,7 @@ public final class CSVPrinter implements Flushable, Closeable {\n \n     @SuppressWarnings(\"resource\")\n     private void printRecords(final IOStream<?> stream) throws IOException {\n-        (format.getMaxRows() > 0 ? stream.limit(format.getMaxRows()) : stream).forEachOrdered(this::printRecordObject);\n+        format.limit(stream).forEachOrdered(this::printRecordObject);\n     }\n \n     /**\n",
      "test_only_diff": "diff --git a/src/test/java/org/apache/commons/csv/CSVParserTest.java b/src/test/java/org/apache/commons/csv/CSVParserTest.java\nindex 59a1dd6e..50bf052b 100644\n--- a/src/test/java/org/apache/commons/csv/CSVParserTest.java\n+++ b/src/test/java/org/apache/commons/csv/CSVParserTest.java\n@@ -62,6 +62,7 @@ import org.junit.jupiter.api.Disabled;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.params.ParameterizedTest;\n import org.junit.jupiter.params.provider.EnumSource;\n+import org.junit.jupiter.params.provider.ValueSource;\n \n /**\n  * CSVParserTest\n@@ -887,6 +888,20 @@ public class CSVParserTest {\n \n     }\n \n+    @ParameterizedTest\n+    @ValueSource(longs = { -1, 0, 1, 2, 3, 4, Long.MAX_VALUE })\n+    public void testGetRecordsMaxRows(final long maxRows) throws IOException {\n+        try (CSVParser parser = CSVParser.parse(CSV_INPUT, CSVFormat.DEFAULT.builder().setIgnoreSurroundingSpaces(true).setMaxRows(maxRows).get())) {\n+            final List<CSVRecord> records = parser.getRecords();\n+            final long expectedLength = maxRows <= 0 || maxRows > RESULT.length ? RESULT.length : maxRows;\n+            assertEquals(expectedLength, records.size());\n+            assertFalse(records.isEmpty());\n+            for (int i = 0; i < expectedLength; i++) {\n+                assertArrayEquals(RESULT[i], records.get(i).values());\n+            }\n+        }\n+    }\n+\n     @Test\n     public void testGetRecordThreeBytesRead() throws Exception {\n         final String code = \"id,date,val5,val4\\n\" +\n@@ -1656,6 +1671,23 @@ public class CSVParserTest {\n         }\n     }\n \n+    @ParameterizedTest\n+    @ValueSource(longs = { -1, 0, 1, 2, 3, 4, Long.MAX_VALUE })\n+    public void testStreamMaxRows(final long maxRows) throws Exception {\n+        final Reader in = new StringReader(\"a,b,c\\n1,2,3\\nx,y,z\");\n+        try (CSVParser parser = CSVFormat.DEFAULT.builder().setMaxRows(maxRows).get().parse(in)) {\n+            final List<CSVRecord> list = parser.stream().collect(Collectors.toList());\n+            assertFalse(list.isEmpty());\n+            assertArrayEquals(new String[] { \"a\", \"b\", \"c\" }, list.get(0).values());\n+            if (maxRows <= 0 || maxRows > 1) {\n+                assertArrayEquals(new String[] { \"1\", \"2\", \"3\" }, list.get(1).values());\n+            }\n+            if (maxRows <= 0 || maxRows > 2) {\n+                assertArrayEquals(new String[] { \"x\", \"y\", \"z\" }, list.get(2).values());\n+            }\n+        }\n+    }\n+\n     @Test\n     public void testThrowExceptionWithLineAndPosition() throws IOException {\n         final String csvContent = \"col1,col2,col3,col4,col5,col6,col7,col8,col9,col10\\nrec1,rec2,rec3,rec4,rec5,rec6,rec7,rec8,\\\"\\\"rec9\\\"\\\",rec10\";\n\ndiff --git a/src/test/java/org/apache/commons/csv/CSVPrinterTest.java b/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\nindex 36542b99..a1a59cf4 100644\n--- a/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\n+++ b/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\n@@ -710,7 +710,7 @@ public class CSVPrinterTest {\n     }\n \n     @ParameterizedTest\n-    @ValueSource(longs = { -1, 0, 1, 2, Integer.MAX_VALUE })\n+    @ValueSource(longs = { -1, 0, 1, 2, Long.MAX_VALUE })\n     public void testExcelPrintAllStreamOfArrays(final long maxRows) throws IOException {\n         final StringWriter sw = new StringWriter();\n         final CSVFormat format = CSVFormat.EXCEL.builder().setMaxRows(maxRows).get();\n@@ -840,7 +840,7 @@ public class CSVPrinterTest {\n     }\n \n     @ParameterizedTest\n-    @ValueSource(longs = { -1, 0, 1, 2, 3, 4, Integer.MAX_VALUE })\n+    @ValueSource(longs = { -1, 0, 1, 2, 3, 4, Long.MAX_VALUE })\n     public void testJdbcPrinterWithResultSet(final long maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n         final CSVFormat format = CSVFormat.DEFAULT.builder().setMaxRows(maxRows).get();\n@@ -864,11 +864,11 @@ public class CSVPrinterTest {\n             assertEquals(allRows, resultString);\n             expectedRowsWithHeader = TABLE_AND_HEADER_RECORD_COUNT;\n         }\n-        assertRowCount(format, resultString, expectedRowsWithHeader);\n+        assertRowCount(CSVFormat.DEFAULT, resultString, expectedRowsWithHeader);\n     }\n \n     @ParameterizedTest\n-    @ValueSource(longs = { -1, 0, 3, 4, Integer.MAX_VALUE })\n+    @ValueSource(longs = { -1, 0, 3, 4, Long.MAX_VALUE })\n     public void testJdbcPrinterWithResultSetHeader(final long maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n         try (Connection connection = getH2Connection()) {\n@@ -887,13 +887,13 @@ public class CSVPrinterTest {\n                     assertEquals(TABLE_RECORD_COUNT * 2, printer.getRecordCount());\n                     assertNotEquals(\"ID,NAME\" + RECORD_SEPARATOR + \"1,r1\" + RECORD_SEPARATOR + \"2,r2\" + RECORD_SEPARATOR, sw.toString());\n                 }\n-                assertRowCount(format, sw.toString(), TABLE_AND_HEADER_RECORD_COUNT + TABLE_RECORD_COUNT);\n+                assertRowCount(CSVFormat.DEFAULT, sw.toString(), TABLE_AND_HEADER_RECORD_COUNT + TABLE_RECORD_COUNT);\n             }\n         }\n     }\n \n     @ParameterizedTest\n-    @ValueSource(longs = { -1, 0, 3, 4, Integer.MAX_VALUE })\n+    @ValueSource(longs = { -1, 0, 3, 4, Long.MAX_VALUE })\n     public void testJdbcPrinterWithResultSetMetaData(final long maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n         try (Connection connection = getH2Connection()) {\n@@ -1509,7 +1509,7 @@ public class CSVPrinterTest {\n     }\n \n     @ParameterizedTest\n-    @ValueSource(longs = { -1, 0, 3, 4, Integer.MAX_VALUE })\n+    @ValueSource(longs = { -1, 0, 3, 4, Long.MAX_VALUE })\n     public void testPrintCSVRecords(final long maxRows) throws IOException {\n         // @formatter:off\n         final String code = \"a1,b1\\n\" + // 1)",
      "stats": {
        "source_files": 4,
        "test_files": 2,
        "filtered": true
      },
      "change_stats": {
        "full": {
          "files": [
            {
              "path": "src/changes/changes.xml",
              "lines_added": 2,
              "lines_removed": 0,
              "is_new": false,
              "is_deleted": false
            },
            {
              "path": "src/main/java/org/apache/commons/csv/CSVFormat.java",
              "lines_added": 11,
              "lines_removed": 0,
              "is_new": false,
              "is_deleted": false
            },
            {
              "path": "src/main/java/org/apache/commons/csv/CSVParser.java",
              "lines_added": 1,
              "lines_removed": 1,
              "is_new": false,
              "is_deleted": false
            },
            {
              "path": "src/main/java/org/apache/commons/csv/CSVPrinter.java",
              "lines_added": 1,
              "lines_removed": 1,
              "is_new": false,
              "is_deleted": false
            },
            {
              "path": "src/test/java/org/apache/commons/csv/CSVParserTest.java",
              "lines_added": 32,
              "lines_removed": 0,
              "is_new": false,
              "is_deleted": false
            },
            {
              "path": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
              "lines_added": 7,
              "lines_removed": 7,
              "is_new": false,
              "is_deleted": false
            }
          ],
          "total_lines_added": 54,
          "total_lines_removed": 9
        },
        "source": {
          "files": [
            {
              "path": "src/changes/changes.xml",
              "lines_added": 2,
              "lines_removed": 0,
              "is_new": false,
              "is_deleted": false
            },
            {
              "path": "src/main/java/org/apache/commons/csv/CSVFormat.java",
              "lines_added": 11,
              "lines_removed": 0,
              "is_new": false,
              "is_deleted": false
            },
            {
              "path": "src/main/java/org/apache/commons/csv/CSVParser.java",
              "lines_added": 1,
              "lines_removed": 1,
              "is_new": false,
              "is_deleted": false
            },
            {
              "path": "src/main/java/org/apache/commons/csv/CSVPrinter.java",
              "lines_added": 1,
              "lines_removed": 1,
              "is_new": false,
              "is_deleted": false
            }
          ],
          "total_lines_added": 15,
          "total_lines_removed": 2
        },
        "test": {
          "files": [
            {
              "path": "src/test/java/org/apache/commons/csv/CSVParserTest.java",
              "lines_added": 32,
              "lines_removed": 0,
              "is_new": false,
              "is_deleted": false
            },
            {
              "path": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
              "lines_added": 7,
              "lines_removed": 7,
              "is_new": false,
              "is_deleted": false
            }
          ],
          "total_lines_added": 39,
          "total_lines_removed": 7
        }
      }
    },
    "method_change_stats": {
      "source": [
        {
          "package": "org.apache.commons.csv",
          "class": "CSVFormat",
          "method": "limit",
          "parameters": [
            "IOStream"
          ],
          "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
          "added_lines": 3,
          "removed_lines": 0,
          "total_changed_lines": 3
        },
        {
          "package": "org.apache.commons.csv",
          "class": "CSVFormat",
          "method": "limit",
          "parameters": [
            "Stream"
          ],
          "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
          "added_lines": 3,
          "removed_lines": 0,
          "total_changed_lines": 3
        },
        {
          "package": "org.apache.commons.csv",
          "class": "CSVParser",
          "method": "stream",
          "parameters": [],
          "file": "src/main/java/org/apache/commons/csv/CSVParser.java",
          "added_lines": 1,
          "removed_lines": 1,
          "total_changed_lines": 2
        },
        {
          "package": "org.apache.commons.csv",
          "class": "CSVPrinter",
          "method": "printRecords",
          "parameters": [
            "IOStream"
          ],
          "file": "src/main/java/org/apache/commons/csv/CSVPrinter.java",
          "added_lines": 1,
          "removed_lines": 1,
          "total_changed_lines": 2
        }
      ],
      "test": [
        {
          "package": "org.apache.commons.csv",
          "class": "CSVParserTest",
          "method": "testGetRecordsMaxRows",
          "parameters": [
            "long"
          ],
          "file": "src/test/java/org/apache/commons/csv/CSVParserTest.java",
          "added_lines": 11,
          "removed_lines": 0,
          "total_changed_lines": 11
        },
        {
          "package": "org.apache.commons.csv",
          "class": "CSVParserTest",
          "method": "testStreamMaxRows",
          "parameters": [
            "long"
          ],
          "file": "src/test/java/org/apache/commons/csv/CSVParserTest.java",
          "added_lines": 14,
          "removed_lines": 0,
          "total_changed_lines": 14
        },
        {
          "package": "org.apache.commons.csv",
          "class": "CSVPrinterTest",
          "method": "testJdbcPrinterWithResultSet",
          "parameters": [
            "long"
          ],
          "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
          "added_lines": 1,
          "removed_lines": 1,
          "total_changed_lines": 2
        },
        {
          "package": "org.apache.commons.csv",
          "class": "CSVPrinterTest",
          "method": "testJdbcPrinterWithResultSetHeader",
          "parameters": [
            "long"
          ],
          "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
          "added_lines": 1,
          "removed_lines": 1,
          "total_changed_lines": 2
        }
      ]
    },
    "has_method_changes": true
  }
}