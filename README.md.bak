# æµ‹è¯•æ¼”åŒ–æ•°æ®é›†æ„å»ºå·¥å…·

ç”¨äºä»Java Mavené¡¹ç›®çš„Gitå†å²ä¸­è‡ªåŠ¨æ„å»ºæµ‹è¯•æ¼”åŒ–æ•°æ®é›†çš„å·¥å…·ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. åˆå§‹ç­›é€‰ (main.py)
ä»Gitå†å²ä¸­ç­›é€‰ç¬¦åˆæ¡ä»¶çš„commitsï¼š
- âœ… åŒæ—¶ä¿®æ”¹æµ‹è¯•ä»£ç å’Œæºä»£ç 
- âœ… æ–¹æ³•çº§åˆ«çš„å˜æ›´æ£€æµ‹
- âœ… æ„å»ºæˆåŠŸéªŒè¯
- âœ… è¦†ç›–ç‡é˜ˆå€¼è¿‡æ»¤ (â‰¥50%)
- âœ… æ”¯æŒå¹¶è¡Œå¤„ç†å’Œæ–­ç‚¹ç»­ä¼ 

### 2. è¿‡æ»¤ç‰ˆæœ¬ç”Ÿæˆ (generate_filtered_versions.py)
ä¸ºæ¯ä¸ªåˆæ ¼çš„commitç”Ÿæˆ V-0.5 å’Œ T-0.5 ç‰ˆæœ¬ï¼š
- âœ… V-0.5ï¼šè¿‡æ»¤æ‰æµ‹è¯•ä»£ç å˜æ›´ï¼Œä»…ä¿ç•™æºä»£ç å˜æ›´
- âœ… T-0.5ï¼šè¿‡æ»¤æ‰æºä»£ç å˜æ›´ï¼Œä»…ä¿ç•™æµ‹è¯•ä»£ç å˜æ›´
- âœ… è‡ªåŠ¨åˆ›å»ºGitåˆ†æ”¯ï¼ˆ`filtered/*` ä¸ `test-only/*`ï¼‰
- âœ… ç¼–è¯‘éªŒè¯
- âœ… åŒæ—¶æ¨¡æ‹Ÿâ€œç¼ºå°‘æµ‹è¯•æ›´æ–°â€å’Œâ€œä»…æµ‹è¯•æ›´æ–°â€çš„çœŸå®åœºæ™¯

## ç‰ˆæœ¬å…³ç³»

æ¯ä¸ªæˆåŠŸå¤„ç†çš„commitåŒ…å«4ä¸ªç‰ˆæœ¬ï¼š

```
V-1 (çˆ¶commit)
  â”œâ”€â”€> V-0.5 (ä»…æºä»£ç å˜æ›´)
  â””â”€â”€> T-0.5 (ä»…æµ‹è¯•ä»£ç å˜æ›´)
                 â””â”€â”€> V0 (å®Œæ•´ç‰ˆæœ¬)
```

- **V-1**: çˆ¶commitï¼Œä½œä¸ºåŸºå‡†ç‰ˆæœ¬
- **V-0.5**: è¿‡æ»¤ç‰ˆæœ¬ï¼ŒåªåŒ…å«æºä»£ç å˜æ›´ï¼ˆæµ‹è¯•ä»£ç æœªæ›´æ–°ï¼‰
- **T-0.5**: æµ‹è¯•ç‰ˆæœ¬ï¼ŒåªåŒ…å«æµ‹è¯•ä»£ç å˜æ›´ï¼ˆæºä»£ç æœªæ›´æ–°ï¼‰
- **V0**: å®Œæ•´ç‰ˆæœ¬ï¼ŒåŒ…å«æ‰€æœ‰å˜æ›´ï¼ˆæºä»£ç +æµ‹è¯•ä»£ç ï¼‰

## æ•°æ®é›†ç»Ÿè®¡

### Commons-CSVé¡¹ç›®ï¼ˆç¤ºä¾‹ï¼‰
- ç»Ÿè®¡ä»¥ `output/filtered_dataset.json` ä¸­çš„ `metadata` ä¸ºå‡†
- å…ƒæ•°æ®å°†åˆ†åˆ«ç»Ÿè®¡ `source_only`ï¼ˆV-0.5ï¼‰ä¸ `test_only`ï¼ˆT-0.5ï¼‰

### æˆåŠŸæ¡ˆä¾‹ç¤ºä¾‹

**æ¡ˆä¾‹ 1: d93c4940ï¼ˆhash ä»¥å®é™…è¾“å‡ºä¸ºå‡†ï¼‰**
```
V-1:  c36d6cde
V-0.5: ab0f7745 (åˆ†æ”¯: filtered/d93c4940)
T-0.5: 5e5d1c2a (åˆ†æ”¯: test-only/d93c4940)
V0:   d93c4940
æ—¥æœŸ: 2025-03-15
æ¶ˆæ¯: CSVParser.parse(*) methods with a null Charset maps to...
```

## ç›®å½•ç»“æ„

```
TUBench/
â”œâ”€â”€ config.py                           # é…ç½®æ–‡ä»¶
â”œâ”€â”€ main.py                             # åˆå§‹ç­›é€‰æµç¨‹
â”œâ”€â”€ generate_filtered_versions.py      # ç”ŸæˆV-0.5/T-0.5
â”œâ”€â”€ test_diff_filter.py                 # æµ‹è¯•diffè¿‡æ»¤åŠŸèƒ½
â”œâ”€â”€ requirements.txt                    # Pythonä¾èµ–
â”œâ”€â”€ modules/                            # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ git_analyzer.py                 # Gitæ“ä½œ
â”‚   â”œâ”€â”€ code_analyzer.py                # Javaä»£ç è§£æ
â”‚   â”œâ”€â”€ change_detector.py              # å˜æ›´æ£€æµ‹
â”‚   â”œâ”€â”€ maven_executor.py               # Mavenæ‰§è¡Œ
â”‚   â”œâ”€â”€ coverage_analyzer.py            # è¦†ç›–ç‡åˆ†æ
â”‚   â”œâ”€â”€ commit_filter.py                # Commitè¿‡æ»¤
â”‚   â”œâ”€â”€ dataset_generator.py            # æ•°æ®é›†ç”Ÿæˆ
â”‚   â”œâ”€â”€ diff_filter.py                  # Diffè¿‡æ»¤ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ filtered_version_generator.py   # è¿‡æ»¤/æµ‹è¯•ç‰ˆæœ¬ç”Ÿæˆï¼ˆæ–°å¢ï¼‰
â””â”€â”€ output/                             # è¾“å‡ºç›®å½•
    â”œâ”€â”€ dataset.json                    # åˆå§‹ç­›é€‰ç»“æœ
    â”œâ”€â”€ filtered_dataset.json           # æœ€ç»ˆæ•°æ®é›†ï¼ˆå«V-0.5/T-0.5ï¼‰
    â””â”€â”€ *.log                            # æ—¥å¿—æ–‡ä»¶
```

## ä½¿ç”¨æ–¹æ³•

### 1. é…ç½®

ç¼–è¾‘ `config.py` è®¾ç½®ä»“åº“è·¯å¾„å’Œè¿‡æ»¤æ¡ä»¶ï¼š

```python
class Config:
    # Gitä»“åº“è·¯å¾„
    REPO_PATH = "/path/to/your/java-project"
    
    # æ—¥æœŸè¿‡æ»¤
    DATE_FILTER = "2016-01-01"
    
    # è¦†ç›–ç‡é˜ˆå€¼ï¼ˆ50%ï¼‰
    COVERAGE_THRESHOLD = 0.5
```

### 2. åˆå§‹ç­›é€‰

```bash
python main.py
```

ç”Ÿæˆ `output/dataset.json`ï¼ŒåŒ…å«æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„commitsã€‚

### 3. ç”Ÿæˆè¿‡æ»¤ç‰ˆæœ¬

```bash
python generate_filtered_versions.py output/dataset.json output/filtered_dataset.json
```

ä¸ºæ¯ä¸ªåˆæ ¼çš„commitç”Ÿæˆ V-0.5 å’Œ T-0.5 ç‰ˆæœ¬ï¼Œä¿å­˜åˆ° `output/filtered_dataset.json`ã€‚

### 4. æµ‹è¯•diffè¿‡æ»¤åŠŸèƒ½

```bash
python test_diff_filter.py
```

### 5. æŸ¥çœ‹ç»“æœ

```bash
# æŸ¥çœ‹ç”Ÿæˆçš„Gitåˆ†æ”¯
cd /path/to/your/java-project
git branch | grep "filtered/"
git branch | grep "test-only/"

# æŸ¥çœ‹æŸä¸ªè¿‡æ»¤åˆ†æ”¯
git log filtered/d93c4940
git log test-only/d93c4940

# å¯¹æ¯”V-0.5å’ŒV0çš„å·®å¼‚ï¼ˆåº”ä¸»è¦æ˜¯æµ‹è¯•å˜æ›´ï¼‰
git diff ab0f7745 d93c4940

# å¯¹æ¯”V-1å’ŒT-0.5çš„å·®å¼‚ï¼ˆåº”ä¸»è¦æ˜¯æµ‹è¯•å˜æ›´ï¼‰
git diff c36d6cde 5e5d1c2a

# å¯¹æ¯”T-0.5å’ŒV0çš„å·®å¼‚ï¼ˆåº”ä¸»è¦æ˜¯æºä»£ç å˜æ›´ï¼‰
git diff 5e5d1c2a d93c4940
```

## æ•°æ®é›†æ ¼å¼

### filtered_dataset.json ç»“æ„ï¼ˆç¤ºä¾‹ï¼Œæ•°å€¼ä»…ç¤ºæ„ï¼‰

```json
{
  "metadata": {
    "source_dataset": "output/dataset.json",
    "total_processed": 130,
    "source_only": {
      "successful": 125,
      "failed": {"apply_patch": 0, "compilation": 5, "other": 0},
      "success_rate": "96.15%"
    },
    "test_only": {
      "successful": 123,
      "failed": {"apply_patch": 0, "compilation": 7, "other": 0},
      "success_rate": "94.62%"
    }
  },
  "commits": [
    {
      "original_commit": "d93c4940...",
      "parent_commit": "c36d6cde...",
      "author": "Gary Gregory",
      "date": "2025-03-15 04:29:53",
      "message": "...",
      "changed_files": {
        "test_files": ["..."],
        "source_files": ["..."],
        "other_files": []
      },
      "changed_methods": {
        "test_methods": [...],
        "source_methods": [...]
      },
      "coverage_analysis": {...},
      "filtered_version": {
        "success": true,
        "filtered_commit_hash": "ab0f7745...",
        "branch_name": "filtered/d93c4940"
      },
      "test_only_version": {
        "success": true,
        "test_only_commit_hash": "5e5d1c2a...",
        "branch_name": "test-only/d93c4940"
      }
    }
  ]
}
```

## æŠ€æœ¯å®ç°

### Diffè¿‡æ»¤ç®—æ³•

ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æGit diffï¼š

1. æŒ‰æ–‡ä»¶åˆ†å‰²diffï¼ˆé€šè¿‡ `diff --git` æ ‡è®°ï¼‰
2. æ ¹æ®æ–‡ä»¶è·¯å¾„åˆ¤æ–­æ˜¯å¦ä¸ºæµ‹è¯•æ–‡ä»¶
3. åˆ†ç¦»æºä»£ç diffå’Œæµ‹è¯•ä»£ç diff
4. ç”ŸæˆåªåŒ…å«æºä»£ç å˜æ›´ / åªåŒ…å«æµ‹è¯•ä»£ç å˜æ›´çš„patch

### ç‰ˆæœ¬ç”Ÿæˆæµç¨‹

1. ä»çˆ¶commitåˆ›å»ºæ–°åˆ†æ”¯
2. åº”ç”¨è¿‡æ»¤åçš„patchï¼ˆåªå«æºä»£ç å˜æ›´ / åªå«æµ‹è¯•ä»£ç å˜æ›´ï¼‰
3. æäº¤å˜æ›´ï¼Œç”Ÿæˆ V-0.5 / T-0.5 ç‰ˆæœ¬
4. ç¼–è¯‘éªŒè¯
5. è®°å½•åˆ†æ”¯ä¿¡æ¯å’Œcommit hash

## ä¾èµ–é¡¹

```
GitPython==3.1.40
javalang==0.13.0
lxml==5.1.0
```

æ³¨ï¼šå·²ç§»é™¤ `unidiff` ä¾èµ–ï¼Œæ”¹ç”¨è‡ªå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼è§£æã€‚

## æ³¨æ„äº‹é¡¹

1. **ä»“åº“çŠ¶æ€**: è¿è¡Œå‰ç¡®ä¿Gitä»“åº“cleanï¼ˆæ— æœªæäº¤çš„å˜æ›´ï¼‰
2. **JDKç‰ˆæœ¬**: ç¡®ä¿å®‰è£…äº†å…¼å®¹çš„JDKç‰ˆæœ¬
3. **Maven**: éœ€è¦Mavenæ„å»ºå·¥å…·
4. **ç£ç›˜ç©ºé—´**: ç”Ÿæˆçš„åˆ†æ”¯ä¼šå ç”¨é¢å¤–ç©ºé—´
5. **å¹¶è¡Œå¤„ç†**: main.pyæ”¯æŒå¹¶è¡Œï¼Œgenerate_filtered_versions.pyä¸²è¡Œå¤„ç†

## å¤±è´¥å¤„ç†

### ç¼–è¯‘å¤±è´¥çš„åŸå› 

å¸¸è§ç¼–è¯‘å¤±è´¥åŸå› ï¼š
- JDKç‰ˆæœ¬ä¸å…¼å®¹ï¼ˆå¦‚é¡¹ç›®éœ€è¦Java 6ï¼Œä½†ç³»ç»Ÿåªæœ‰Java 8+ï¼‰
- Maven cleanå¤±è´¥ï¼ˆæ–‡ä»¶è¢«å ç”¨ï¼‰
- ä¾èµ–ä¸‹è½½å¤±è´¥

å¤±è´¥çš„commitsä¼šè¢«è·³è¿‡ï¼Œä¸å½±å“å…¶ä»–commitsçš„å¤„ç†ã€‚

### æ¸…ç†åˆ†æ”¯

å¦‚éœ€æ¸…ç†ç”Ÿæˆçš„åˆ†æ”¯ï¼š

```bash
cd /path/to/your/java-project
git branch | grep "filtered/" | xargs git branch -D
git branch | grep "test-only/" | xargs git branch -D
```

## å®éªŒåœºæ™¯

æ­¤æ•°æ®é›†å¯ç”¨äºä»¥ä¸‹ç ”ç©¶ï¼š

1. **æµ‹è¯•æ¼”åŒ–ç ”ç©¶**: ç ”ç©¶æµ‹è¯•ç”¨ä¾‹å¦‚ä½•éšæºä»£ç æ¼”åŒ–
2. **æµ‹è¯•ç”Ÿæˆ**: åŸºäºV-0.5ç”Ÿæˆæµ‹è¯•ï¼Œä¸V0å¯¹æ¯”
3. **æµ‹è¯•ä¿®å¤**: æ£€æµ‹å’Œä¿®å¤ä¸å®Œæ•´çš„æµ‹è¯•æ›´æ–°
4. **è¦†ç›–ç‡åˆ†æ**: åˆ†æä»£ç å˜æ›´å¯¹è¦†ç›–ç‡çš„å½±å“

## é¡¹ç›®çŠ¶æ€

âœ… **å·²å®Œæˆ**
- åˆå§‹ç­›é€‰æµç¨‹
- Diffè¿‡æ»¤åŠŸèƒ½
- è¿‡æ»¤/æµ‹è¯•ç‰ˆæœ¬ç”Ÿæˆ
- ç¼–è¯‘éªŒè¯
- æ•°æ®é›†å¯¼å‡º

ğŸ‰ **æµ‹è¯•ç»“æœ**: æˆåŠŸç‡ä»¥ `filtered_dataset.json` çš„ `metadata` ä¸ºå‡†

## ä½œè€…

æµ‹è¯•æ¼”åŒ–æ•°æ®é›†æ„å»ºå·¥å…· - 2025
