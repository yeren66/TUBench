{
  "commit_hash": "30f0e1d6cafb2f6bec24b82493d850e5ae787173",
  "parent_hash": "c62d12a8ec5f987c3107674c03c8577fbbb70033",
  "basic_info": {
    "project": "commons-csv",
    "commit_hash": "30f0e1d6cafb2f6bec24b82493d850e5ae787173",
    "short_hash": "30f0e1d6",
    "parent_hash": "c62d12a8ec5f987c3107674c03c8577fbbb70033",
    "parent_short_hash": "c62d12a8",
    "author": "Gary Gregory",
    "date": "2025-03-07 17:06:57",
    "message": "CSVPrinter.printRecords(ResultSet) knows how to use CSVFormat's maxRows\n\n- Add CSVFormat.Builder.setMaxRows(long)\n- Add CSVFormat.getMaxRows()",
    "message_subject": "CSVPrinter.printRecords(ResultSet) knows how to use CSVFormat's maxRows"
  },
  "file_changes": {
    "source_files": [
      {
        "path": "src/main/java/org/apache/commons/csv/CSVFormat.java",
        "change_type": "modified",
        "old_path": null,
        "is_java": true
      },
      {
        "path": "src/main/java/org/apache/commons/csv/CSVPrinter.java",
        "change_type": "modified",
        "old_path": null,
        "is_java": true
      }
    ],
    "test_files": [
      {
        "path": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "change_type": "modified",
        "old_path": null,
        "is_java": true
      }
    ],
    "other_files": [
      {
        "path": "src/changes/changes.xml",
        "change_type": "modified",
        "old_path": null,
        "is_java": false
      }
    ],
    "summary": {
      "total_files": 4,
      "source_count": 2,
      "test_count": 1,
      "other_count": 1
    }
  },
  "method_changes": {
    "source_methods": [
      {
        "class": "Builder",
        "method": "setLenientEof",
        "parameters": [
          "boolean"
        ],
        "start_line": 740,
        "end_line": 743,
        "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
        "package": "org.apache.commons.csv"
      },
      {
        "class": "Builder",
        "method": "setMaxRows",
        "parameters": [
          "long"
        ],
        "start_line": 752,
        "end_line": 755,
        "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
        "package": "org.apache.commons.csv"
      },
      {
        "class": "Builder",
        "method": "setTrailingDelimiter",
        "parameters": [
          "boolean"
        ],
        "start_line": 871,
        "end_line": 874,
        "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
        "package": "org.apache.commons.csv"
      },
      {
        "class": "CSVFormat",
        "method": "append",
        "parameters": [
          "char",
          "Appendable"
        ],
        "start_line": 1629,
        "end_line": 1635,
        "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
        "package": "org.apache.commons.csv"
      },
      {
        "class": "CSVFormat",
        "method": "getLenientEof",
        "parameters": [],
        "start_line": 1918,
        "end_line": 1920,
        "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
        "package": "org.apache.commons.csv"
      },
      {
        "class": "CSVFormat",
        "method": "getMaxRows",
        "parameters": [],
        "start_line": 1928,
        "end_line": 1930,
        "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
        "package": "org.apache.commons.csv"
      },
      {
        "class": "CSVFormat",
        "method": "hashCode",
        "parameters": [],
        "start_line": 2011,
        "end_line": 2019,
        "file": "src/main/java/org/apache/commons/csv/CSVFormat.java",
        "package": "org.apache.commons.csv"
      },
      {
        "class": "CSVPrinter",
        "method": "printRecords",
        "parameters": [
          "ResultSet"
        ],
        "start_line": 441,
        "end_line": 461,
        "file": "src/main/java/org/apache/commons/csv/CSVPrinter.java",
        "package": "org.apache.commons.csv"
      }
    ],
    "test_methods": [
      {
        "class": "CSVPrinterTest",
        "method": "printable",
        "parameters": [
          "String"
        ],
        "start_line": 88,
        "end_line": 99,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "assertInitialState",
        "parameters": [
          "CSVPrinter"
        ],
        "start_line": 103,
        "end_line": 105,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testCRComment",
        "parameters": [],
        "start_line": 331,
        "end_line": 343,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testDontQuoteEuroFirstChar",
        "parameters": [],
        "start_line": 471,
        "end_line": 478,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrintAllArrayOfArrays",
        "parameters": [],
        "start_line": 623,
        "end_line": 630,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrintAllArrayOfArraysWithFirstEmptyValue2",
        "parameters": [],
        "start_line": 633,
        "end_line": 640,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrintAllArrayOfArraysWithFirstSpaceValue1",
        "parameters": [],
        "start_line": 643,
        "end_line": 650,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrintAllArrayOfArraysWithFirstTabValue1",
        "parameters": [],
        "start_line": 653,
        "end_line": 660,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrintAllArrayOfLists",
        "parameters": [],
        "start_line": 663,
        "end_line": 670,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrintAllArrayOfListsWithFirstEmptyValue2",
        "parameters": [],
        "start_line": 673,
        "end_line": 680,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrintAllIterableOfArrays",
        "parameters": [],
        "start_line": 683,
        "end_line": 690,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrintAllIterableOfArraysWithFirstEmptyValue2",
        "parameters": [],
        "start_line": 693,
        "end_line": 700,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrintAllIterableOfLists",
        "parameters": [],
        "start_line": 703,
        "end_line": 710,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrintAllStreamOfArrays",
        "parameters": [],
        "start_line": 713,
        "end_line": 720,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrinter1",
        "parameters": [],
        "start_line": 723,
        "end_line": 730,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testExcelPrinter2",
        "parameters": [],
        "start_line": 733,
        "end_line": 740,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testJdbcPrinter",
        "parameters": [],
        "start_line": 790,
        "end_line": 821,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testJdbcPrinterWithFirstEmptyValue2",
        "parameters": [],
        "start_line": 824,
        "end_line": 834,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testJdbcPrinterWithResultSet",
        "parameters": [
          "int"
        ],
        "start_line": 838,
        "end_line": 862,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testJdbcPrinterWithResultSetHeader",
        "parameters": [
          "int"
        ],
        "start_line": 866,
        "end_line": 887,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testJdbcPrinterWithResultSetMetaData",
        "parameters": [
          "int"
        ],
        "start_line": 891,
        "end_line": 908,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testMongoDbCsvBasic",
        "parameters": [],
        "start_line": 975,
        "end_line": 982,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testMongoDbCsvCommaInValue",
        "parameters": [],
        "start_line": 985,
        "end_line": 992,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testMongoDbCsvDoubleQuoteInValue",
        "parameters": [],
        "start_line": 995,
        "end_line": 1002,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testMongoDbCsvTabInValue",
        "parameters": [],
        "start_line": 1005,
        "end_line": 1012,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testMongoDbTsvBasic",
        "parameters": [],
        "start_line": 1015,
        "end_line": 1022,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testMongoDbTsvCommaInValue",
        "parameters": [],
        "start_line": 1025,
        "end_line": 1032,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testMongoDbTsvTabInValue",
        "parameters": [],
        "start_line": 1035,
        "end_line": 1041,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testMultiLineComment",
        "parameters": [],
        "start_line": 1044,
        "end_line": 1051,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testNotFlushable",
        "parameters": [],
        "start_line": 1171,
        "end_line": 1178,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testParseCustomNullValues",
        "parameters": [],
        "start_line": 1181,
        "end_line": 1197,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrint",
        "parameters": [],
        "start_line": 1445,
        "end_line": 1452,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrintCustomNullValues",
        "parameters": [],
        "start_line": 1529,
        "end_line": 1536,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrinter1",
        "parameters": [],
        "start_line": 1539,
        "end_line": 1547,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrinter2",
        "parameters": [],
        "start_line": 1550,
        "end_line": 1557,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrinter3",
        "parameters": [],
        "start_line": 1560,
        "end_line": 1567,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrinter4",
        "parameters": [],
        "start_line": 1570,
        "end_line": 1577,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrinter5",
        "parameters": [],
        "start_line": 1580,
        "end_line": 1587,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrinter6",
        "parameters": [],
        "start_line": 1590,
        "end_line": 1597,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrinter7",
        "parameters": [],
        "start_line": 1600,
        "end_line": 1607,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrintNullValues",
        "parameters": [],
        "start_line": 1610,
        "end_line": 1617,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrintToFileWithCharsetUtf16Be",
        "parameters": [],
        "start_line": 1759,
        "end_line": 1765,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrintToFileWithDefaultCharset",
        "parameters": [],
        "start_line": 1768,
        "end_line": 1774,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testPrintToPathWithDefaultCharset",
        "parameters": [],
        "start_line": 1777,
        "end_line": 1783,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testQuoteAll",
        "parameters": [],
        "start_line": 1786,
        "end_line": 1792,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testQuoteCommaFirstChar",
        "parameters": [],
        "start_line": 1795,
        "end_line": 1801,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testQuoteNonNumeric",
        "parameters": [],
        "start_line": 1804,
        "end_line": 1810,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      },
      {
        "class": "CSVPrinterTest",
        "method": "testSingleLineComment",
        "parameters": [],
        "start_line": 1861,
        "end_line": 1868,
        "file": "src/test/java/org/apache/commons/csv/CSVPrinterTest.java",
        "package": "org.apache.commons.csv",
        "is_test_method": false
      }
    ],
    "summary": {
      "source_methods_count": 8,
      "test_methods_count": 48
    }
  },
  "diff_info": {
    "full_diff": "diff --git a/src/changes/changes.xml b/src/changes/changes.xml\nindex c245957e..8632cf78 100644\n--- a/src/changes/changes.xml\n+++ b/src/changes/changes.xml\n@@ -46,6 +46,9 @@\n       <action type=\"fix\" dev=\"ggregory\" due-to=\"Gary Gregory\">Remove -nouses directive from maven-bundle-plugin. OSGi package imports now state 'uses' definitions for package imports, this doesn't affect JPMS (from org.apache.commons:commons-parent:80).</action>\n       <!-- ADD -->\n       <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">Define and use Maven property commons.jmh.version.</action> \n+      <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">Add CSVFormat.Builder.setMaxRows(long).</action> \n+      <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">Add CSVFormat.getMaxRows().</action> \n+      <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVPrinter.printRecords(ResultSet) knows how to use CSVFormat's maxRows.</action> \n       <!-- UPDATE -->\n       <action type=\"update\" dev=\"ggregory\" due-to=\"Gary Gregory\">Bump com.opencsv:opencsv from 5.9 to 5.10.</action>\n       <action type=\"update\" dev=\"ggregory\" due-to=\"Gary Gregory\">Bump commons-codec:commons-codec from 1.17.2 to 1.18.0 #522.</action>\ndiff --git a/src/main/java/org/apache/commons/csv/CSVFormat.java b/src/main/java/org/apache/commons/csv/CSVFormat.java\nindex 70c033a1..ea1613ba 100644\n--- a/src/main/java/org/apache/commons/csv/CSVFormat.java\n+++ b/src/main/java/org/apache/commons/csv/CSVFormat.java\n@@ -270,32 +270,36 @@ public final class CSVFormat implements Serializable {\n \n         private boolean trim;\n \n+        /** The maximum number of rows to process, excluding the header row. */\n+        private long maxRows;\n+\n         private Builder() {\n             // empty\n         }\n \n         private Builder(final CSVFormat csvFormat) {\n-            this.delimiter = csvFormat.delimiter;\n-            this.quoteCharacter = csvFormat.quoteCharacter;\n-            this.quoteMode = csvFormat.quoteMode;\n+            this.allowMissingColumnNames = csvFormat.allowMissingColumnNames;\n+            this.autoFlush = csvFormat.autoFlush;\n             this.commentMarker = csvFormat.commentMarker;\n+            this.delimiter = csvFormat.delimiter;\n+            this.duplicateHeaderMode = csvFormat.duplicateHeaderMode;\n             this.escapeCharacter = csvFormat.escapeCharacter;\n-            this.ignoreSurroundingSpaces = csvFormat.ignoreSurroundingSpaces;\n-            this.allowMissingColumnNames = csvFormat.allowMissingColumnNames;\n-            this.ignoreEmptyLines = csvFormat.ignoreEmptyLines;\n-            this.recordSeparator = csvFormat.recordSeparator;\n-            this.nullString = csvFormat.nullString;\n             this.headerComments = csvFormat.headerComments;\n             this.headers = csvFormat.headers;\n-            this.skipHeaderRecord = csvFormat.skipHeaderRecord;\n+            this.ignoreEmptyLines = csvFormat.ignoreEmptyLines;\n             this.ignoreHeaderCase = csvFormat.ignoreHeaderCase;\n+            this.ignoreSurroundingSpaces = csvFormat.ignoreSurroundingSpaces;\n             this.lenientEof = csvFormat.lenientEof;\n+            this.maxRows = csvFormat.maxRows;\n+            this.nullString = csvFormat.nullString;\n+            this.quoteCharacter = csvFormat.quoteCharacter;\n+            this.quoteMode = csvFormat.quoteMode;\n+            this.quotedNullString = csvFormat.quotedNullString;\n+            this.recordSeparator = csvFormat.recordSeparator;\n+            this.skipHeaderRecord = csvFormat.skipHeaderRecord;\n             this.trailingData = csvFormat.trailingData;\n             this.trailingDelimiter = csvFormat.trailingDelimiter;\n             this.trim = csvFormat.trim;\n-            this.autoFlush = csvFormat.autoFlush;\n-            this.quotedNullString = csvFormat.quotedNullString;\n-            this.duplicateHeaderMode = csvFormat.duplicateHeaderMode;\n         }\n \n         /**\n@@ -738,6 +742,18 @@ public final class CSVFormat implements Serializable {\n             return this;\n         }\n \n+        /**\n+         * Sets the maximum number of rows to process, excluding the header row.\n+         *\n+         * @param maxRows the maximum number of rows to process, excluding the header row.\n+         * @return This instance.\n+         * @since 1.14.0\n+         */\n+        public Builder setMaxRows(final long maxRows) {\n+            this.maxRows = maxRows;\n+            return this;\n+        }\n+\n         /**\n          * Sets the String to convert to and from {@code null}. No substitution occurs if {@code null}.\n          *\n@@ -857,6 +873,7 @@ public final class CSVFormat implements Serializable {\n             return this;\n         }\n \n+\n         /**\n          * Sets whether to trim leading and trailing blanks.\n          *\n@@ -1580,28 +1597,32 @@ public final class CSVFormat implements Serializable {\n     /** Whether to trim leading and trailing blanks. */\n     private final boolean trim;\n \n+    /** The maximum number of rows to process, excluding the header row. */\n+    private final long maxRows;\n+\n     private CSVFormat(final Builder builder) {\n-        this.delimiter = builder.delimiter;\n-        this.quoteCharacter = builder.quoteCharacter;\n-        this.quoteMode = builder.quoteMode;\n+        this.allowMissingColumnNames = builder.allowMissingColumnNames;\n+        this.autoFlush = builder.autoFlush;\n         this.commentMarker = builder.commentMarker;\n+        this.delimiter = builder.delimiter;\n+        this.duplicateHeaderMode = builder.duplicateHeaderMode;\n         this.escapeCharacter = builder.escapeCharacter;\n-        this.ignoreSurroundingSpaces = builder.ignoreSurroundingSpaces;\n-        this.allowMissingColumnNames = builder.allowMissingColumnNames;\n-        this.ignoreEmptyLines = builder.ignoreEmptyLines;\n-        this.recordSeparator = builder.recordSeparator;\n-        this.nullString = builder.nullString;\n         this.headerComments = builder.headerComments;\n         this.headers = builder.headers;\n-        this.skipHeaderRecord = builder.skipHeaderRecord;\n+        this.ignoreEmptyLines = builder.ignoreEmptyLines;\n         this.ignoreHeaderCase = builder.ignoreHeaderCase;\n+        this.ignoreSurroundingSpaces = builder.ignoreSurroundingSpaces;\n         this.lenientEof = builder.lenientEof;\n+        this.maxRows = builder.maxRows;\n+        this.nullString = builder.nullString;\n+        this.quoteCharacter = builder.quoteCharacter;\n+        this.quoteMode = builder.quoteMode;\n+        this.quotedNullString = builder.quotedNullString;\n+        this.recordSeparator = builder.recordSeparator;\n+        this.skipHeaderRecord = builder.skipHeaderRecord;\n         this.trailingData = builder.trailingData;\n         this.trailingDelimiter = builder.trailingDelimiter;\n         this.trim = builder.trim;\n-        this.autoFlush = builder.autoFlush;\n-        this.quotedNullString = builder.quotedNullString;\n-        this.duplicateHeaderMode = builder.duplicateHeaderMode;\n         validate();\n     }\n \n@@ -1898,6 +1919,16 @@ public final class CSVFormat implements Serializable {\n         return lenientEof;\n     }\n \n+    /**\n+     * Gets the maximum number of rows to process, excluding the header row.\n+     *\n+     * @return The maximum number of rows to process, excluding the header row.\n+     * @since 1.14.0\n+     */\n+    public long getMaxRows() {\n+        return maxRows;\n+    }\n+\n     /**\n      * Gets the String to convert to and from {@code null}.\n      * <ul>\n@@ -1982,10 +2013,9 @@ public final class CSVFormat implements Serializable {\n         int result = 1;\n         result = prime * result + Arrays.hashCode(headerComments);\n         result = prime * result + Arrays.hashCode(headers);\n-        result = prime * result + Objects.hash(allowMissingColumnNames, autoFlush, commentMarker, delimiter, duplicateHeaderMode, escapeCharacter,\n+        return prime * result + Objects.hash(allowMissingColumnNames, autoFlush, commentMarker, delimiter, duplicateHeaderMode, escapeCharacter,\n                 ignoreEmptyLines, ignoreHeaderCase, ignoreSurroundingSpaces, lenientEof, nullString, quoteCharacter, quoteMode, quotedNullString,\n                 recordSeparator, skipHeaderRecord, trailingData, trailingDelimiter, trim);\n-        return result;\n     }\n \n     /**\ndiff --git a/src/main/java/org/apache/commons/csv/CSVPrinter.java b/src/main/java/org/apache/commons/csv/CSVPrinter.java\nindex 67088c38..a09e0b63 100644\n--- a/src/main/java/org/apache/commons/csv/CSVPrinter.java\n+++ b/src/main/java/org/apache/commons/csv/CSVPrinter.java\n@@ -32,6 +32,7 @@ import java.sql.Blob;\n import java.sql.Clob;\n import java.sql.ResultSet;\n import java.sql.SQLException;\n+import java.sql.Statement;\n import java.util.Arrays;\n import java.util.Objects;\n import java.util.stream.Stream;\n@@ -428,17 +429,19 @@ public final class CSVPrinter implements Flushable, Closeable {\n \n     /**\n      * Prints all the objects in the given JDBC result set.\n+     * <p>\n+     * You can use {@link CSVFormat.Builder#setMaxRows(long)} to limit how many rows a result set produces. This is most useful when you cannot limit rows\n+     * through {@link Statement#setLargeMaxRows(long)}.\n+     * </p>\n      *\n-     * @param resultSet\n-     *             The values to print.\n-     * @throws IOException\n-     *             If an I/O error occurs.\n-     * @throws SQLException\n-     *             Thrown when a database access error occurs.\n+     * @param resultSet The values to print.\n+     * @throws IOException  If an I/O error occurs.\n+     * @throws SQLException Thrown when a database access error occurs.\n      */\n     public void printRecords(final ResultSet resultSet) throws SQLException, IOException {\n         final int columnCount = resultSet.getMetaData().getColumnCount();\n-        while (resultSet.next()) {\n+        final long maxRows = format.getMaxRows();\n+        while (resultSet.next() && (maxRows < 1 || resultSet.getRow() <= maxRows)) {\n             for (int i = 1; i <= columnCount; i++) {\n                 final Object object = resultSet.getObject(i);\n                 if (object instanceof Clob) {\n@@ -459,6 +462,10 @@ public final class CSVPrinter implements Flushable, Closeable {\n \n     /**\n      * Prints all the objects with metadata in the given JDBC result set based on the header boolean.\n+     * <p>\n+     * You can use {@link CSVFormat.Builder#setMaxRows(long)} to limit how many rows a result set produces. This is most useful when you cannot limit rows\n+     * through {@link Statement#setLargeMaxRows(long)}.\n+     * </p>\n      *\n      * @param resultSet source of row data.\n      * @param printHeader whether to print headers.\ndiff --git a/src/test/java/org/apache/commons/csv/CSVPrinterTest.java b/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\nindex d34ccd47..9e865a1a 100644\n--- a/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\n+++ b/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\n@@ -69,6 +69,8 @@ import org.apache.commons.lang3.StringUtils;\n import org.h2.tools.SimpleResultSet;\n import org.junit.jupiter.api.Disabled;\n import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.ValueSource;\n \n /**\n  * Tests {@link CSVPrinter}.\n@@ -81,6 +83,7 @@ public class CSVPrinterTest {\n     private static final char EURO_CH = '\\u20AC';\n     private static final int ITERATIONS_FOR_RANDOM_TEST = 50_000;\n     private static final char QUOTE_CH = '\\'';\n+    private static final String RECORD_SEPARATOR = CSVFormat.DEFAULT.getRecordSeparator();\n \n     private static String printable(final String s) {\n         final StringBuilder sb = new StringBuilder();\n@@ -97,8 +100,6 @@ public class CSVPrinterTest {\n \n     private String longText2;\n \n-    private final String recordSeparator = CSVFormat.DEFAULT.getRecordSeparator();\n-\n     private void assertInitialState(final CSVPrinter printer) {\n         assertEquals(0, printer.getRecordCount());\n     }\n@@ -335,8 +336,8 @@ public class CSVPrinterTest {\n             printer.print(value);\n             assertEquals(0, printer.getRecordCount());\n             printer.printComment(\"This is a comment\\r\\non multiple lines\\rthis is next comment\\r\");\n-            assertEquals(\"abc\" + recordSeparator + \"# This is a comment\" + recordSeparator + \"# on multiple lines\" + recordSeparator +\n-                    \"# this is next comment\" + recordSeparator + \"# \" + recordSeparator, sw.toString());\n+            assertEquals(\"abc\" + RECORD_SEPARATOR + \"# This is a comment\" + RECORD_SEPARATOR + \"# on multiple lines\" + RECORD_SEPARATOR +\n+                    \"# this is next comment\" + RECORD_SEPARATOR + \"# \" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(0, printer.getRecordCount());\n         }\n     }\n@@ -472,7 +473,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.RFC4180)) {\n             assertInitialState(printer);\n             printer.printRecord(EURO_CH, \"Deux\");\n-            assertEquals(EURO_CH + \",Deux\" + recordSeparator, sw.toString());\n+            assertEquals(EURO_CH + \",Deux\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -624,7 +625,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new String[][] { { \"r1c1\", \"r1c2\" }, { \"r2c1\", \"r2c2\" } });\n-            assertEquals(\"r1c1,r1c2\" + recordSeparator + \"r2c1,r2c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"r1c1,r1c2\" + RECORD_SEPARATOR + \"r2c1,r2c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -634,7 +635,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new String[][] { { \"\" } });\n-            assertEquals(\"\\\"\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -644,7 +645,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new String[][] { { \" \", \"r1c2\" } });\n-            assertEquals(\"\\\" \\\",r1c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\" \\\",r1c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -654,7 +655,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new String[][] { { \"\\t\", \"r1c2\" } });\n-            assertEquals(\"\\\"\\t\\\",r1c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"\\t\\\",r1c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -664,7 +665,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new List[] { Arrays.asList(\"r1c1\", \"r1c2\"), Arrays.asList(\"r2c1\", \"r2c2\") });\n-            assertEquals(\"r1c1,r1c2\" + recordSeparator + \"r2c1,r2c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"r1c1,r1c2\" + RECORD_SEPARATOR + \"r2c1,r2c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -674,7 +675,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new List[] { Arrays.asList(\"\") });\n-            assertEquals(\"\\\"\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -684,7 +685,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords(Arrays.asList(new String[][] { { \"r1c1\", \"r1c2\" }, { \"r2c1\", \"r2c2\" } }));\n-            assertEquals(\"r1c1,r1c2\" + recordSeparator + \"r2c1,r2c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"r1c1,r1c2\" + RECORD_SEPARATOR + \"r2c1,r2c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -694,7 +695,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords(Arrays.asList(new String[][] { { \"\" } }));\n-            assertEquals(\"\\\"\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -704,7 +705,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords(Arrays.asList(Arrays.asList(\"r1c1\", \"r1c2\"), Arrays.asList(\"r2c1\", \"r2c2\")));\n-            assertEquals(\"r1c1,r1c2\" + recordSeparator + \"r2c1,r2c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"r1c1,r1c2\" + RECORD_SEPARATOR + \"r2c1,r2c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -714,7 +715,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords(Stream.of(new String[][] { { \"r1c1\", \"r1c2\" }, { \"r2c1\", \"r2c2\" } }));\n-            assertEquals(\"r1c1,r1c2\" + recordSeparator + \"r2c1,r2c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"r1c1,r1c2\" + RECORD_SEPARATOR + \"r2c1,r2c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -724,7 +725,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\");\n-            assertEquals(\"a,b\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -734,7 +735,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a,b\", \"b\");\n-            assertEquals(\"\\\"a,b\\\",b\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a,b\\\",b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -800,8 +801,8 @@ public class CSVPrinterTest {\n             }\n         }\n         final String csv = sw.toString();\n-        assertEquals(\"1,r1,\\\"long text 1\\\",\\\"YmluYXJ5IGRhdGEgMQ==\\r\\n\\\"\" + recordSeparator + \"2,r2,\\\"\" + longText2 + \"\\\",\\\"YmluYXJ5IGRhdGEgMg==\\r\\n\\\"\" +\n-                recordSeparator, csv);\n+        assertEquals(\"1,r1,\\\"long text 1\\\",\\\"YmluYXJ5IGRhdGEgMQ==\\r\\n\\\"\" + RECORD_SEPARATOR + \"2,r2,\\\"\" + longText2 + \"\\\",\\\"YmluYXJ5IGRhdGEgMg==\\r\\n\\\"\" +\n+                RECORD_SEPARATOR, csv);\n         // Round trip the data\n         try (StringReader reader = new StringReader(csv);\n                 CSVParser csvParser = csvFormat.parse(reader)) {\n@@ -829,13 +830,14 @@ public class CSVPrinterTest {\n                 printer.printRecords(resultSet);\n             }\n         }\n-        assertEquals(\"EMPTYVALUE\" + recordSeparator + \"\\\"\\\"\" + recordSeparator, sw.toString());\n+        assertEquals(\"EMPTYVALUE\" + RECORD_SEPARATOR + \"\\\"\\\"\" + RECORD_SEPARATOR, sw.toString());\n     }\n \n-    @Test\n-    public void testJdbcPrinterWithResultSet() throws IOException, ClassNotFoundException, SQLException {\n+    @ParameterizedTest\n+    @ValueSource(ints = { -1, 0, 1, 2, 3, 4, Integer.MAX_VALUE })\n+    public void testJdbcPrinterWithResultSet(final int maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n-        final CSVFormat format = CSVFormat.DEFAULT;\n+        final CSVFormat format = CSVFormat.DEFAULT.builder().setMaxRows(maxRows).get();\n         try (Connection connection = getH2Connection()) {\n             setUpTable(connection);\n             try (Statement stmt = connection.createStatement();\n@@ -845,41 +847,52 @@ public class CSVPrinterTest {\n             }\n         }\n         final String resultString = sw.toString();\n-        assertEquals(\"ID,NAME,TEXT\" + recordSeparator + \"1,r1,\\\"long text 1\\\"\" + recordSeparator + \"2,r2,\\\"\" + longText2 + \"\\\"\" + recordSeparator,\n-                resultString);\n-        assertRowCount(format, resultString, TABLE_AND_HEADER_RECORD_COUNT);\n+        final String header = \"ID,NAME,TEXT\";\n+        final String headerRow1 = header + RECORD_SEPARATOR + \"1,r1,\\\"long text 1\\\"\" + RECORD_SEPARATOR;\n+        final String allRows = headerRow1 + \"2,r2,\\\"\" + longText2 + \"\\\"\" + RECORD_SEPARATOR;\n+        final int expectedRowsWithHeader;\n+        if (maxRows == 1) {\n+            assertEquals(headerRow1, resultString);\n+            expectedRowsWithHeader = 2;\n+        } else {\n+            assertEquals(allRows, resultString);\n+            expectedRowsWithHeader = TABLE_AND_HEADER_RECORD_COUNT;\n+        }\n+        assertRowCount(format, resultString, expectedRowsWithHeader);\n     }\n \n-    @Test\n-    public void testJdbcPrinterWithResultSetHeader() throws IOException, ClassNotFoundException, SQLException {\n+    @ParameterizedTest\n+    @ValueSource(ints = { -1, 0, 3, 4, Integer.MAX_VALUE })\n+    public void testJdbcPrinterWithResultSetHeader(final int maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n         try (Connection connection = getH2Connection()) {\n             setUpTable(connection);\n-            final CSVFormat format = CSVFormat.DEFAULT;\n+            final CSVFormat format = CSVFormat.DEFAULT.builder().setMaxRows(maxRows).get();\n             try (Statement stmt = connection.createStatement();\n                     CSVPrinter printer = new CSVPrinter(sw, format)) {\n                 try (ResultSet resultSet = stmt.executeQuery(\"select ID, NAME from TEST\")) {\n                     printer.printRecords(resultSet, true);\n                     assertEquals(TABLE_RECORD_COUNT, printer.getRecordCount());\n-                    assertEquals(\"ID,NAME\" + recordSeparator + \"1,r1\" + recordSeparator + \"2,r2\" + recordSeparator, sw.toString());\n+                    assertEquals(\"ID,NAME\" + RECORD_SEPARATOR + \"1,r1\" + RECORD_SEPARATOR + \"2,r2\" + RECORD_SEPARATOR, sw.toString());\n                 }\n                 assertRowCount(format, sw.toString(), TABLE_AND_HEADER_RECORD_COUNT);\n                 try (ResultSet resultSet = stmt.executeQuery(\"select ID, NAME from TEST\")) {\n                     printer.printRecords(resultSet, false);\n                     assertEquals(TABLE_RECORD_COUNT * 2, printer.getRecordCount());\n-                    assertNotEquals(\"ID,NAME\" + recordSeparator + \"1,r1\" + recordSeparator + \"2,r2\" + recordSeparator, sw.toString());\n+                    assertNotEquals(\"ID,NAME\" + RECORD_SEPARATOR + \"1,r1\" + RECORD_SEPARATOR + \"2,r2\" + RECORD_SEPARATOR, sw.toString());\n                 }\n                 assertRowCount(format, sw.toString(), TABLE_AND_HEADER_RECORD_COUNT + TABLE_RECORD_COUNT);\n             }\n         }\n     }\n \n-    @Test\n-    public void testJdbcPrinterWithResultSetMetaData() throws IOException, ClassNotFoundException, SQLException {\n+    @ParameterizedTest\n+    @ValueSource(ints = { -1, 0, 3, 4, Integer.MAX_VALUE })\n+    public void testJdbcPrinterWithResultSetMetaData(final int maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n         try (Connection connection = getH2Connection()) {\n             setUpTable(connection);\n-            final CSVFormat format = CSVFormat.DEFAULT;\n+            final CSVFormat format = CSVFormat.DEFAULT.builder().setMaxRows(maxRows).get();\n             try (Statement stmt = connection.createStatement();\n                     ResultSet resultSet = stmt.executeQuery(\"select ID, NAME, TEXT from TEST\");\n                     CSVPrinter printer = format.withHeader(resultSet.getMetaData()).print(sw)) {\n@@ -887,7 +900,7 @@ public class CSVPrinterTest {\n                 assertEquals(1, printer.getRecordCount());\n                 printer.printRecords(resultSet);\n                 assertEquals(3, printer.getRecordCount());\n-                assertEquals(\"ID,NAME,TEXT\" + recordSeparator + \"1,r1,\\\"long text 1\\\"\" + recordSeparator + \"2,r2,\\\"\" + longText2 + \"\\\"\" + recordSeparator,\n+                assertEquals(\"ID,NAME,TEXT\" + RECORD_SEPARATOR + \"1,r1,\\\"long text 1\\\"\" + RECORD_SEPARATOR + \"2,r2,\\\"\" + longText2 + \"\\\"\" + RECORD_SEPARATOR,\n                         sw.toString());\n             }\n             assertRowCount(format, sw.toString(), TABLE_AND_HEADER_RECORD_COUNT);\n@@ -963,7 +976,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_CSV)) {\n             printer.printRecord(\"a\", \"b\");\n-            assertEquals(\"a,b\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -973,7 +986,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_CSV)) {\n             printer.printRecord(\"a,b\", \"c\");\n-            assertEquals(\"\\\"a,b\\\",c\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a,b\\\",c\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -983,7 +996,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_CSV)) {\n             printer.printRecord(\"a \\\"c\\\" b\", \"d\");\n-            assertEquals(\"\\\"a \\\"\\\"c\\\"\\\" b\\\",d\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a \\\"\\\"c\\\"\\\" b\\\",d\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -993,7 +1006,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_CSV)) {\n             printer.printRecord(\"a\\tb\", \"c\");\n-            assertEquals(\"a\\tb,c\" + recordSeparator, sw.toString());\n+            assertEquals(\"a\\tb,c\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -1003,7 +1016,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_TSV)) {\n             printer.printRecord(\"a\", \"b\");\n-            assertEquals(\"a\\tb\" + recordSeparator, sw.toString());\n+            assertEquals(\"a\\tb\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -1013,7 +1026,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_TSV)) {\n             printer.printRecord(\"a,b\", \"c\");\n-            assertEquals(\"a,b\\tc\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\\tc\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -1023,7 +1036,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_TSV)) {\n             printer.printRecord(\"a\\tb\", \"c\");\n-            assertEquals(\"\\\"a\\tb\\\"\\tc\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a\\tb\\\"\\tc\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1032,7 +1045,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT.withCommentMarker('#'))) {\n             printer.printComment(\"This is a comment\\non multiple lines\");\n-            assertEquals(\"# This is a comment\" + recordSeparator + \"# on multiple lines\" + recordSeparator, sw.toString());\n+            assertEquals(\"# This is a comment\" + RECORD_SEPARATOR + \"# on multiple lines\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(0, printer.getRecordCount());\n         }\n     }\n@@ -1159,7 +1172,7 @@ public class CSVPrinterTest {\n         final Appendable out = new StringBuilder();\n         try (CSVPrinter printer = new CSVPrinter(out, CSVFormat.DEFAULT)) {\n             printer.printRecord(\"a\", \"b\", \"c\");\n-            assertEquals(\"a,b,c\" + recordSeparator, out.toString());\n+            assertEquals(\"a,b,c\" + RECORD_SEPARATOR, out.toString());\n             printer.flush();\n         }\n     }\n@@ -1172,7 +1185,7 @@ public class CSVPrinterTest {\n             printer.printRecord(\"a\", null, \"b\");\n         }\n         final String csvString = sw.toString();\n-        assertEquals(\"a,NULL,b\" + recordSeparator, csvString);\n+        assertEquals(\"a,NULL,b\" + RECORD_SEPARATOR, csvString);\n         try (CSVParser iterable = format.parse(new StringReader(csvString))) {\n             final Iterator<CSVRecord> iterator = iterable.iterator();\n             final CSVRecord record = iterator.next();\n@@ -1434,7 +1447,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = CSVFormat.DEFAULT.print(sw)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\\\\c\");\n-            assertEquals(\"a,b\\\\c\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\\\\c\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1518,7 +1531,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT.withNullString(\"NULL\"))) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", null, \"b\");\n-            assertEquals(\"a,NULL,b\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,NULL,b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1529,7 +1542,7 @@ public class CSVPrinterTest {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\");\n             assertEquals(1, printer.getRecordCount());\n-            assertEquals(\"a,b\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1539,7 +1552,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a,b\", \"b\");\n-            assertEquals(\"\\\"a,b\\\",b\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a,b\\\",b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1549,7 +1562,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a, b\", \"b \");\n-            assertEquals(\"\\\"a, b\\\",\\\"b \\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a, b\\\",\\\"b \\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1559,7 +1572,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\\\"c\");\n-            assertEquals(\"a,\\\"b\\\"\\\"c\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,\\\"b\\\"\\\"c\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1569,7 +1582,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\\nc\");\n-            assertEquals(\"a,\\\"b\\nc\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,\\\"b\\nc\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1579,7 +1592,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\\r\\nc\");\n-            assertEquals(\"a,\\\"b\\r\\nc\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,\\\"b\\r\\nc\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1589,7 +1602,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\\\\c\");\n-            assertEquals(\"a,b\\\\c\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\\\\c\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1599,7 +1612,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", null, \"b\");\n-            assertEquals(\"a,,b\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,,b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1748,7 +1761,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = CSVFormat.DEFAULT.print(file, StandardCharsets.UTF_16BE)) {\n             printer.printRecord(\"a\", \"b\\\\c\");\n         }\n-        assertEquals(\"a,b\\\\c\" + recordSeparator, FileUtils.readFileToString(file, StandardCharsets.UTF_16BE));\n+        assertEquals(\"a,b\\\\c\" + RECORD_SEPARATOR, FileUtils.readFileToString(file, StandardCharsets.UTF_16BE));\n     }\n \n     @Test\n@@ -1757,7 +1770,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = CSVFormat.DEFAULT.print(file, Charset.defaultCharset())) {\n             printer.printRecord(\"a\", \"b\\\\c\");\n         }\n-        assertEquals(\"a,b\\\\c\" + recordSeparator, FileUtils.readFileToString(file, Charset.defaultCharset()));\n+        assertEquals(\"a,b\\\\c\" + RECORD_SEPARATOR, FileUtils.readFileToString(file, Charset.defaultCharset()));\n     }\n \n     @Test\n@@ -1766,7 +1779,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = CSVFormat.DEFAULT.print(file, Charset.defaultCharset())) {\n             printer.printRecord(\"a\", \"b\\\\c\");\n         }\n-        assertEquals(\"a,b\\\\c\" + recordSeparator, new String(Files.readAllBytes(file), Charset.defaultCharset()));\n+        assertEquals(\"a,b\\\\c\" + RECORD_SEPARATOR, new String(Files.readAllBytes(file), Charset.defaultCharset()));\n     }\n \n     @Test\n@@ -1774,7 +1787,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT.withQuoteMode(QuoteMode.ALL))) {\n             printer.printRecord(\"a\", \"b\\nc\", \"d\");\n-            assertEquals(\"\\\"a\\\",\\\"b\\nc\\\",\\\"d\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a\\\",\\\"b\\nc\\\",\\\"d\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1783,7 +1796,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.RFC4180)) {\n             printer.printRecord(\",\");\n-            assertEquals(\"\\\",\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\",\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1792,7 +1805,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT.withQuoteMode(QuoteMode.NON_NUMERIC))) {\n             printer.printRecord(\"a\", \"b\\nc\", Integer.valueOf(1));\n-            assertEquals(\"\\\"a\\\",\\\"b\\nc\\\",1\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a\\\",\\\"b\\nc\\\",1\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1849,7 +1862,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT.withCommentMarker('#'))) {\n             printer.printComment(\"This is a comment\");\n-            assertEquals(\"# This is a comment\" + recordSeparator, sw.toString());\n+            assertEquals(\"# This is a comment\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(0, printer.getRecordCount());\n         }\n     }",
    "source_only_diff": "diff --git a/src/changes/changes.xml b/src/changes/changes.xml\nindex c245957e..8632cf78 100644\n--- a/src/changes/changes.xml\n+++ b/src/changes/changes.xml\n@@ -46,6 +46,9 @@\n       <action type=\"fix\" dev=\"ggregory\" due-to=\"Gary Gregory\">Remove -nouses directive from maven-bundle-plugin. OSGi package imports now state 'uses' definitions for package imports, this doesn't affect JPMS (from org.apache.commons:commons-parent:80).</action>\n       <!-- ADD -->\n       <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">Define and use Maven property commons.jmh.version.</action> \n+      <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">Add CSVFormat.Builder.setMaxRows(long).</action> \n+      <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">Add CSVFormat.getMaxRows().</action> \n+      <action type=\"add\" dev=\"ggregory\" due-to=\"Gary Gregory\">CSVPrinter.printRecords(ResultSet) knows how to use CSVFormat's maxRows.</action> \n       <!-- UPDATE -->\n       <action type=\"update\" dev=\"ggregory\" due-to=\"Gary Gregory\">Bump com.opencsv:opencsv from 5.9 to 5.10.</action>\n       <action type=\"update\" dev=\"ggregory\" due-to=\"Gary Gregory\">Bump commons-codec:commons-codec from 1.17.2 to 1.18.0 #522.</action>\n\ndiff --git a/src/main/java/org/apache/commons/csv/CSVFormat.java b/src/main/java/org/apache/commons/csv/CSVFormat.java\nindex 70c033a1..ea1613ba 100644\n--- a/src/main/java/org/apache/commons/csv/CSVFormat.java\n+++ b/src/main/java/org/apache/commons/csv/CSVFormat.java\n@@ -270,32 +270,36 @@ public final class CSVFormat implements Serializable {\n \n         private boolean trim;\n \n+        /** The maximum number of rows to process, excluding the header row. */\n+        private long maxRows;\n+\n         private Builder() {\n             // empty\n         }\n \n         private Builder(final CSVFormat csvFormat) {\n-            this.delimiter = csvFormat.delimiter;\n-            this.quoteCharacter = csvFormat.quoteCharacter;\n-            this.quoteMode = csvFormat.quoteMode;\n+            this.allowMissingColumnNames = csvFormat.allowMissingColumnNames;\n+            this.autoFlush = csvFormat.autoFlush;\n             this.commentMarker = csvFormat.commentMarker;\n+            this.delimiter = csvFormat.delimiter;\n+            this.duplicateHeaderMode = csvFormat.duplicateHeaderMode;\n             this.escapeCharacter = csvFormat.escapeCharacter;\n-            this.ignoreSurroundingSpaces = csvFormat.ignoreSurroundingSpaces;\n-            this.allowMissingColumnNames = csvFormat.allowMissingColumnNames;\n-            this.ignoreEmptyLines = csvFormat.ignoreEmptyLines;\n-            this.recordSeparator = csvFormat.recordSeparator;\n-            this.nullString = csvFormat.nullString;\n             this.headerComments = csvFormat.headerComments;\n             this.headers = csvFormat.headers;\n-            this.skipHeaderRecord = csvFormat.skipHeaderRecord;\n+            this.ignoreEmptyLines = csvFormat.ignoreEmptyLines;\n             this.ignoreHeaderCase = csvFormat.ignoreHeaderCase;\n+            this.ignoreSurroundingSpaces = csvFormat.ignoreSurroundingSpaces;\n             this.lenientEof = csvFormat.lenientEof;\n+            this.maxRows = csvFormat.maxRows;\n+            this.nullString = csvFormat.nullString;\n+            this.quoteCharacter = csvFormat.quoteCharacter;\n+            this.quoteMode = csvFormat.quoteMode;\n+            this.quotedNullString = csvFormat.quotedNullString;\n+            this.recordSeparator = csvFormat.recordSeparator;\n+            this.skipHeaderRecord = csvFormat.skipHeaderRecord;\n             this.trailingData = csvFormat.trailingData;\n             this.trailingDelimiter = csvFormat.trailingDelimiter;\n             this.trim = csvFormat.trim;\n-            this.autoFlush = csvFormat.autoFlush;\n-            this.quotedNullString = csvFormat.quotedNullString;\n-            this.duplicateHeaderMode = csvFormat.duplicateHeaderMode;\n         }\n \n         /**\n@@ -738,6 +742,18 @@ public final class CSVFormat implements Serializable {\n             return this;\n         }\n \n+        /**\n+         * Sets the maximum number of rows to process, excluding the header row.\n+         *\n+         * @param maxRows the maximum number of rows to process, excluding the header row.\n+         * @return This instance.\n+         * @since 1.14.0\n+         */\n+        public Builder setMaxRows(final long maxRows) {\n+            this.maxRows = maxRows;\n+            return this;\n+        }\n+\n         /**\n          * Sets the String to convert to and from {@code null}. No substitution occurs if {@code null}.\n          *\n@@ -857,6 +873,7 @@ public final class CSVFormat implements Serializable {\n             return this;\n         }\n \n+\n         /**\n          * Sets whether to trim leading and trailing blanks.\n          *\n@@ -1580,28 +1597,32 @@ public final class CSVFormat implements Serializable {\n     /** Whether to trim leading and trailing blanks. */\n     private final boolean trim;\n \n+    /** The maximum number of rows to process, excluding the header row. */\n+    private final long maxRows;\n+\n     private CSVFormat(final Builder builder) {\n-        this.delimiter = builder.delimiter;\n-        this.quoteCharacter = builder.quoteCharacter;\n-        this.quoteMode = builder.quoteMode;\n+        this.allowMissingColumnNames = builder.allowMissingColumnNames;\n+        this.autoFlush = builder.autoFlush;\n         this.commentMarker = builder.commentMarker;\n+        this.delimiter = builder.delimiter;\n+        this.duplicateHeaderMode = builder.duplicateHeaderMode;\n         this.escapeCharacter = builder.escapeCharacter;\n-        this.ignoreSurroundingSpaces = builder.ignoreSurroundingSpaces;\n-        this.allowMissingColumnNames = builder.allowMissingColumnNames;\n-        this.ignoreEmptyLines = builder.ignoreEmptyLines;\n-        this.recordSeparator = builder.recordSeparator;\n-        this.nullString = builder.nullString;\n         this.headerComments = builder.headerComments;\n         this.headers = builder.headers;\n-        this.skipHeaderRecord = builder.skipHeaderRecord;\n+        this.ignoreEmptyLines = builder.ignoreEmptyLines;\n         this.ignoreHeaderCase = builder.ignoreHeaderCase;\n+        this.ignoreSurroundingSpaces = builder.ignoreSurroundingSpaces;\n         this.lenientEof = builder.lenientEof;\n+        this.maxRows = builder.maxRows;\n+        this.nullString = builder.nullString;\n+        this.quoteCharacter = builder.quoteCharacter;\n+        this.quoteMode = builder.quoteMode;\n+        this.quotedNullString = builder.quotedNullString;\n+        this.recordSeparator = builder.recordSeparator;\n+        this.skipHeaderRecord = builder.skipHeaderRecord;\n         this.trailingData = builder.trailingData;\n         this.trailingDelimiter = builder.trailingDelimiter;\n         this.trim = builder.trim;\n-        this.autoFlush = builder.autoFlush;\n-        this.quotedNullString = builder.quotedNullString;\n-        this.duplicateHeaderMode = builder.duplicateHeaderMode;\n         validate();\n     }\n \n@@ -1898,6 +1919,16 @@ public final class CSVFormat implements Serializable {\n         return lenientEof;\n     }\n \n+    /**\n+     * Gets the maximum number of rows to process, excluding the header row.\n+     *\n+     * @return The maximum number of rows to process, excluding the header row.\n+     * @since 1.14.0\n+     */\n+    public long getMaxRows() {\n+        return maxRows;\n+    }\n+\n     /**\n      * Gets the String to convert to and from {@code null}.\n      * <ul>\n@@ -1982,10 +2013,9 @@ public final class CSVFormat implements Serializable {\n         int result = 1;\n         result = prime * result + Arrays.hashCode(headerComments);\n         result = prime * result + Arrays.hashCode(headers);\n-        result = prime * result + Objects.hash(allowMissingColumnNames, autoFlush, commentMarker, delimiter, duplicateHeaderMode, escapeCharacter,\n+        return prime * result + Objects.hash(allowMissingColumnNames, autoFlush, commentMarker, delimiter, duplicateHeaderMode, escapeCharacter,\n                 ignoreEmptyLines, ignoreHeaderCase, ignoreSurroundingSpaces, lenientEof, nullString, quoteCharacter, quoteMode, quotedNullString,\n                 recordSeparator, skipHeaderRecord, trailingData, trailingDelimiter, trim);\n-        return result;\n     }\n \n     /**\n\ndiff --git a/src/main/java/org/apache/commons/csv/CSVPrinter.java b/src/main/java/org/apache/commons/csv/CSVPrinter.java\nindex 67088c38..a09e0b63 100644\n--- a/src/main/java/org/apache/commons/csv/CSVPrinter.java\n+++ b/src/main/java/org/apache/commons/csv/CSVPrinter.java\n@@ -32,6 +32,7 @@ import java.sql.Blob;\n import java.sql.Clob;\n import java.sql.ResultSet;\n import java.sql.SQLException;\n+import java.sql.Statement;\n import java.util.Arrays;\n import java.util.Objects;\n import java.util.stream.Stream;\n@@ -428,17 +429,19 @@ public final class CSVPrinter implements Flushable, Closeable {\n \n     /**\n      * Prints all the objects in the given JDBC result set.\n+     * <p>\n+     * You can use {@link CSVFormat.Builder#setMaxRows(long)} to limit how many rows a result set produces. This is most useful when you cannot limit rows\n+     * through {@link Statement#setLargeMaxRows(long)}.\n+     * </p>\n      *\n-     * @param resultSet\n-     *             The values to print.\n-     * @throws IOException\n-     *             If an I/O error occurs.\n-     * @throws SQLException\n-     *             Thrown when a database access error occurs.\n+     * @param resultSet The values to print.\n+     * @throws IOException  If an I/O error occurs.\n+     * @throws SQLException Thrown when a database access error occurs.\n      */\n     public void printRecords(final ResultSet resultSet) throws SQLException, IOException {\n         final int columnCount = resultSet.getMetaData().getColumnCount();\n-        while (resultSet.next()) {\n+        final long maxRows = format.getMaxRows();\n+        while (resultSet.next() && (maxRows < 1 || resultSet.getRow() <= maxRows)) {\n             for (int i = 1; i <= columnCount; i++) {\n                 final Object object = resultSet.getObject(i);\n                 if (object instanceof Clob) {\n@@ -459,6 +462,10 @@ public final class CSVPrinter implements Flushable, Closeable {\n \n     /**\n      * Prints all the objects with metadata in the given JDBC result set based on the header boolean.\n+     * <p>\n+     * You can use {@link CSVFormat.Builder#setMaxRows(long)} to limit how many rows a result set produces. This is most useful when you cannot limit rows\n+     * through {@link Statement#setLargeMaxRows(long)}.\n+     * </p>\n      *\n      * @param resultSet source of row data.\n      * @param printHeader whether to print headers.\n",
    "test_only_diff": "diff --git a/src/test/java/org/apache/commons/csv/CSVPrinterTest.java b/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\nindex d34ccd47..9e865a1a 100644\n--- a/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\n+++ b/src/test/java/org/apache/commons/csv/CSVPrinterTest.java\n@@ -69,6 +69,8 @@ import org.apache.commons.lang3.StringUtils;\n import org.h2.tools.SimpleResultSet;\n import org.junit.jupiter.api.Disabled;\n import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.ValueSource;\n \n /**\n  * Tests {@link CSVPrinter}.\n@@ -81,6 +83,7 @@ public class CSVPrinterTest {\n     private static final char EURO_CH = '\\u20AC';\n     private static final int ITERATIONS_FOR_RANDOM_TEST = 50_000;\n     private static final char QUOTE_CH = '\\'';\n+    private static final String RECORD_SEPARATOR = CSVFormat.DEFAULT.getRecordSeparator();\n \n     private static String printable(final String s) {\n         final StringBuilder sb = new StringBuilder();\n@@ -97,8 +100,6 @@ public class CSVPrinterTest {\n \n     private String longText2;\n \n-    private final String recordSeparator = CSVFormat.DEFAULT.getRecordSeparator();\n-\n     private void assertInitialState(final CSVPrinter printer) {\n         assertEquals(0, printer.getRecordCount());\n     }\n@@ -335,8 +336,8 @@ public class CSVPrinterTest {\n             printer.print(value);\n             assertEquals(0, printer.getRecordCount());\n             printer.printComment(\"This is a comment\\r\\non multiple lines\\rthis is next comment\\r\");\n-            assertEquals(\"abc\" + recordSeparator + \"# This is a comment\" + recordSeparator + \"# on multiple lines\" + recordSeparator +\n-                    \"# this is next comment\" + recordSeparator + \"# \" + recordSeparator, sw.toString());\n+            assertEquals(\"abc\" + RECORD_SEPARATOR + \"# This is a comment\" + RECORD_SEPARATOR + \"# on multiple lines\" + RECORD_SEPARATOR +\n+                    \"# this is next comment\" + RECORD_SEPARATOR + \"# \" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(0, printer.getRecordCount());\n         }\n     }\n@@ -472,7 +473,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.RFC4180)) {\n             assertInitialState(printer);\n             printer.printRecord(EURO_CH, \"Deux\");\n-            assertEquals(EURO_CH + \",Deux\" + recordSeparator, sw.toString());\n+            assertEquals(EURO_CH + \",Deux\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -624,7 +625,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new String[][] { { \"r1c1\", \"r1c2\" }, { \"r2c1\", \"r2c2\" } });\n-            assertEquals(\"r1c1,r1c2\" + recordSeparator + \"r2c1,r2c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"r1c1,r1c2\" + RECORD_SEPARATOR + \"r2c1,r2c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -634,7 +635,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new String[][] { { \"\" } });\n-            assertEquals(\"\\\"\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -644,7 +645,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new String[][] { { \" \", \"r1c2\" } });\n-            assertEquals(\"\\\" \\\",r1c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\" \\\",r1c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -654,7 +655,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new String[][] { { \"\\t\", \"r1c2\" } });\n-            assertEquals(\"\\\"\\t\\\",r1c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"\\t\\\",r1c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -664,7 +665,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new List[] { Arrays.asList(\"r1c1\", \"r1c2\"), Arrays.asList(\"r2c1\", \"r2c2\") });\n-            assertEquals(\"r1c1,r1c2\" + recordSeparator + \"r2c1,r2c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"r1c1,r1c2\" + RECORD_SEPARATOR + \"r2c1,r2c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -674,7 +675,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords((Object[]) new List[] { Arrays.asList(\"\") });\n-            assertEquals(\"\\\"\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -684,7 +685,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords(Arrays.asList(new String[][] { { \"r1c1\", \"r1c2\" }, { \"r2c1\", \"r2c2\" } }));\n-            assertEquals(\"r1c1,r1c2\" + recordSeparator + \"r2c1,r2c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"r1c1,r1c2\" + RECORD_SEPARATOR + \"r2c1,r2c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -694,7 +695,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords(Arrays.asList(new String[][] { { \"\" } }));\n-            assertEquals(\"\\\"\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -704,7 +705,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords(Arrays.asList(Arrays.asList(\"r1c1\", \"r1c2\"), Arrays.asList(\"r2c1\", \"r2c2\")));\n-            assertEquals(\"r1c1,r1c2\" + recordSeparator + \"r2c1,r2c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"r1c1,r1c2\" + RECORD_SEPARATOR + \"r2c1,r2c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -714,7 +715,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecords(Stream.of(new String[][] { { \"r1c1\", \"r1c2\" }, { \"r2c1\", \"r2c2\" } }));\n-            assertEquals(\"r1c1,r1c2\" + recordSeparator + \"r2c1,r2c2\" + recordSeparator, sw.toString());\n+            assertEquals(\"r1c1,r1c2\" + RECORD_SEPARATOR + \"r2c1,r2c2\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -724,7 +725,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\");\n-            assertEquals(\"a,b\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -734,7 +735,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.EXCEL)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a,b\", \"b\");\n-            assertEquals(\"\\\"a,b\\\",b\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a,b\\\",b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -800,8 +801,8 @@ public class CSVPrinterTest {\n             }\n         }\n         final String csv = sw.toString();\n-        assertEquals(\"1,r1,\\\"long text 1\\\",\\\"YmluYXJ5IGRhdGEgMQ==\\r\\n\\\"\" + recordSeparator + \"2,r2,\\\"\" + longText2 + \"\\\",\\\"YmluYXJ5IGRhdGEgMg==\\r\\n\\\"\" +\n-                recordSeparator, csv);\n+        assertEquals(\"1,r1,\\\"long text 1\\\",\\\"YmluYXJ5IGRhdGEgMQ==\\r\\n\\\"\" + RECORD_SEPARATOR + \"2,r2,\\\"\" + longText2 + \"\\\",\\\"YmluYXJ5IGRhdGEgMg==\\r\\n\\\"\" +\n+                RECORD_SEPARATOR, csv);\n         // Round trip the data\n         try (StringReader reader = new StringReader(csv);\n                 CSVParser csvParser = csvFormat.parse(reader)) {\n@@ -829,13 +830,14 @@ public class CSVPrinterTest {\n                 printer.printRecords(resultSet);\n             }\n         }\n-        assertEquals(\"EMPTYVALUE\" + recordSeparator + \"\\\"\\\"\" + recordSeparator, sw.toString());\n+        assertEquals(\"EMPTYVALUE\" + RECORD_SEPARATOR + \"\\\"\\\"\" + RECORD_SEPARATOR, sw.toString());\n     }\n \n-    @Test\n-    public void testJdbcPrinterWithResultSet() throws IOException, ClassNotFoundException, SQLException {\n+    @ParameterizedTest\n+    @ValueSource(ints = { -1, 0, 1, 2, 3, 4, Integer.MAX_VALUE })\n+    public void testJdbcPrinterWithResultSet(final int maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n-        final CSVFormat format = CSVFormat.DEFAULT;\n+        final CSVFormat format = CSVFormat.DEFAULT.builder().setMaxRows(maxRows).get();\n         try (Connection connection = getH2Connection()) {\n             setUpTable(connection);\n             try (Statement stmt = connection.createStatement();\n@@ -845,41 +847,52 @@ public class CSVPrinterTest {\n             }\n         }\n         final String resultString = sw.toString();\n-        assertEquals(\"ID,NAME,TEXT\" + recordSeparator + \"1,r1,\\\"long text 1\\\"\" + recordSeparator + \"2,r2,\\\"\" + longText2 + \"\\\"\" + recordSeparator,\n-                resultString);\n-        assertRowCount(format, resultString, TABLE_AND_HEADER_RECORD_COUNT);\n+        final String header = \"ID,NAME,TEXT\";\n+        final String headerRow1 = header + RECORD_SEPARATOR + \"1,r1,\\\"long text 1\\\"\" + RECORD_SEPARATOR;\n+        final String allRows = headerRow1 + \"2,r2,\\\"\" + longText2 + \"\\\"\" + RECORD_SEPARATOR;\n+        final int expectedRowsWithHeader;\n+        if (maxRows == 1) {\n+            assertEquals(headerRow1, resultString);\n+            expectedRowsWithHeader = 2;\n+        } else {\n+            assertEquals(allRows, resultString);\n+            expectedRowsWithHeader = TABLE_AND_HEADER_RECORD_COUNT;\n+        }\n+        assertRowCount(format, resultString, expectedRowsWithHeader);\n     }\n \n-    @Test\n-    public void testJdbcPrinterWithResultSetHeader() throws IOException, ClassNotFoundException, SQLException {\n+    @ParameterizedTest\n+    @ValueSource(ints = { -1, 0, 3, 4, Integer.MAX_VALUE })\n+    public void testJdbcPrinterWithResultSetHeader(final int maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n         try (Connection connection = getH2Connection()) {\n             setUpTable(connection);\n-            final CSVFormat format = CSVFormat.DEFAULT;\n+            final CSVFormat format = CSVFormat.DEFAULT.builder().setMaxRows(maxRows).get();\n             try (Statement stmt = connection.createStatement();\n                     CSVPrinter printer = new CSVPrinter(sw, format)) {\n                 try (ResultSet resultSet = stmt.executeQuery(\"select ID, NAME from TEST\")) {\n                     printer.printRecords(resultSet, true);\n                     assertEquals(TABLE_RECORD_COUNT, printer.getRecordCount());\n-                    assertEquals(\"ID,NAME\" + recordSeparator + \"1,r1\" + recordSeparator + \"2,r2\" + recordSeparator, sw.toString());\n+                    assertEquals(\"ID,NAME\" + RECORD_SEPARATOR + \"1,r1\" + RECORD_SEPARATOR + \"2,r2\" + RECORD_SEPARATOR, sw.toString());\n                 }\n                 assertRowCount(format, sw.toString(), TABLE_AND_HEADER_RECORD_COUNT);\n                 try (ResultSet resultSet = stmt.executeQuery(\"select ID, NAME from TEST\")) {\n                     printer.printRecords(resultSet, false);\n                     assertEquals(TABLE_RECORD_COUNT * 2, printer.getRecordCount());\n-                    assertNotEquals(\"ID,NAME\" + recordSeparator + \"1,r1\" + recordSeparator + \"2,r2\" + recordSeparator, sw.toString());\n+                    assertNotEquals(\"ID,NAME\" + RECORD_SEPARATOR + \"1,r1\" + RECORD_SEPARATOR + \"2,r2\" + RECORD_SEPARATOR, sw.toString());\n                 }\n                 assertRowCount(format, sw.toString(), TABLE_AND_HEADER_RECORD_COUNT + TABLE_RECORD_COUNT);\n             }\n         }\n     }\n \n-    @Test\n-    public void testJdbcPrinterWithResultSetMetaData() throws IOException, ClassNotFoundException, SQLException {\n+    @ParameterizedTest\n+    @ValueSource(ints = { -1, 0, 3, 4, Integer.MAX_VALUE })\n+    public void testJdbcPrinterWithResultSetMetaData(final int maxRows) throws IOException, ClassNotFoundException, SQLException {\n         final StringWriter sw = new StringWriter();\n         try (Connection connection = getH2Connection()) {\n             setUpTable(connection);\n-            final CSVFormat format = CSVFormat.DEFAULT;\n+            final CSVFormat format = CSVFormat.DEFAULT.builder().setMaxRows(maxRows).get();\n             try (Statement stmt = connection.createStatement();\n                     ResultSet resultSet = stmt.executeQuery(\"select ID, NAME, TEXT from TEST\");\n                     CSVPrinter printer = format.withHeader(resultSet.getMetaData()).print(sw)) {\n@@ -887,7 +900,7 @@ public class CSVPrinterTest {\n                 assertEquals(1, printer.getRecordCount());\n                 printer.printRecords(resultSet);\n                 assertEquals(3, printer.getRecordCount());\n-                assertEquals(\"ID,NAME,TEXT\" + recordSeparator + \"1,r1,\\\"long text 1\\\"\" + recordSeparator + \"2,r2,\\\"\" + longText2 + \"\\\"\" + recordSeparator,\n+                assertEquals(\"ID,NAME,TEXT\" + RECORD_SEPARATOR + \"1,r1,\\\"long text 1\\\"\" + RECORD_SEPARATOR + \"2,r2,\\\"\" + longText2 + \"\\\"\" + RECORD_SEPARATOR,\n                         sw.toString());\n             }\n             assertRowCount(format, sw.toString(), TABLE_AND_HEADER_RECORD_COUNT);\n@@ -963,7 +976,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_CSV)) {\n             printer.printRecord(\"a\", \"b\");\n-            assertEquals(\"a,b\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -973,7 +986,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_CSV)) {\n             printer.printRecord(\"a,b\", \"c\");\n-            assertEquals(\"\\\"a,b\\\",c\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a,b\\\",c\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -983,7 +996,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_CSV)) {\n             printer.printRecord(\"a \\\"c\\\" b\", \"d\");\n-            assertEquals(\"\\\"a \\\"\\\"c\\\"\\\" b\\\",d\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a \\\"\\\"c\\\"\\\" b\\\",d\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -993,7 +1006,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_CSV)) {\n             printer.printRecord(\"a\\tb\", \"c\");\n-            assertEquals(\"a\\tb,c\" + recordSeparator, sw.toString());\n+            assertEquals(\"a\\tb,c\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -1003,7 +1016,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_TSV)) {\n             printer.printRecord(\"a\", \"b\");\n-            assertEquals(\"a\\tb\" + recordSeparator, sw.toString());\n+            assertEquals(\"a\\tb\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -1013,7 +1026,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_TSV)) {\n             printer.printRecord(\"a,b\", \"c\");\n-            assertEquals(\"a,b\\tc\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\\tc\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(1, printer.getRecordCount());\n         }\n     }\n@@ -1023,7 +1036,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.MONGODB_TSV)) {\n             printer.printRecord(\"a\\tb\", \"c\");\n-            assertEquals(\"\\\"a\\tb\\\"\\tc\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a\\tb\\\"\\tc\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1032,7 +1045,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT.withCommentMarker('#'))) {\n             printer.printComment(\"This is a comment\\non multiple lines\");\n-            assertEquals(\"# This is a comment\" + recordSeparator + \"# on multiple lines\" + recordSeparator, sw.toString());\n+            assertEquals(\"# This is a comment\" + RECORD_SEPARATOR + \"# on multiple lines\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(0, printer.getRecordCount());\n         }\n     }\n@@ -1159,7 +1172,7 @@ public class CSVPrinterTest {\n         final Appendable out = new StringBuilder();\n         try (CSVPrinter printer = new CSVPrinter(out, CSVFormat.DEFAULT)) {\n             printer.printRecord(\"a\", \"b\", \"c\");\n-            assertEquals(\"a,b,c\" + recordSeparator, out.toString());\n+            assertEquals(\"a,b,c\" + RECORD_SEPARATOR, out.toString());\n             printer.flush();\n         }\n     }\n@@ -1172,7 +1185,7 @@ public class CSVPrinterTest {\n             printer.printRecord(\"a\", null, \"b\");\n         }\n         final String csvString = sw.toString();\n-        assertEquals(\"a,NULL,b\" + recordSeparator, csvString);\n+        assertEquals(\"a,NULL,b\" + RECORD_SEPARATOR, csvString);\n         try (CSVParser iterable = format.parse(new StringReader(csvString))) {\n             final Iterator<CSVRecord> iterator = iterable.iterator();\n             final CSVRecord record = iterator.next();\n@@ -1434,7 +1447,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = CSVFormat.DEFAULT.print(sw)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\\\\c\");\n-            assertEquals(\"a,b\\\\c\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\\\\c\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1518,7 +1531,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT.withNullString(\"NULL\"))) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", null, \"b\");\n-            assertEquals(\"a,NULL,b\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,NULL,b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1529,7 +1542,7 @@ public class CSVPrinterTest {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\");\n             assertEquals(1, printer.getRecordCount());\n-            assertEquals(\"a,b\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1539,7 +1552,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a,b\", \"b\");\n-            assertEquals(\"\\\"a,b\\\",b\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a,b\\\",b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1549,7 +1562,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a, b\", \"b \");\n-            assertEquals(\"\\\"a, b\\\",\\\"b \\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a, b\\\",\\\"b \\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1559,7 +1572,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\\\"c\");\n-            assertEquals(\"a,\\\"b\\\"\\\"c\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,\\\"b\\\"\\\"c\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1569,7 +1582,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\\nc\");\n-            assertEquals(\"a,\\\"b\\nc\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,\\\"b\\nc\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1579,7 +1592,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\\r\\nc\");\n-            assertEquals(\"a,\\\"b\\r\\nc\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,\\\"b\\r\\nc\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1589,7 +1602,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", \"b\\\\c\");\n-            assertEquals(\"a,b\\\\c\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,b\\\\c\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1599,7 +1612,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT)) {\n             assertInitialState(printer);\n             printer.printRecord(\"a\", null, \"b\");\n-            assertEquals(\"a,,b\" + recordSeparator, sw.toString());\n+            assertEquals(\"a,,b\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1748,7 +1761,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = CSVFormat.DEFAULT.print(file, StandardCharsets.UTF_16BE)) {\n             printer.printRecord(\"a\", \"b\\\\c\");\n         }\n-        assertEquals(\"a,b\\\\c\" + recordSeparator, FileUtils.readFileToString(file, StandardCharsets.UTF_16BE));\n+        assertEquals(\"a,b\\\\c\" + RECORD_SEPARATOR, FileUtils.readFileToString(file, StandardCharsets.UTF_16BE));\n     }\n \n     @Test\n@@ -1757,7 +1770,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = CSVFormat.DEFAULT.print(file, Charset.defaultCharset())) {\n             printer.printRecord(\"a\", \"b\\\\c\");\n         }\n-        assertEquals(\"a,b\\\\c\" + recordSeparator, FileUtils.readFileToString(file, Charset.defaultCharset()));\n+        assertEquals(\"a,b\\\\c\" + RECORD_SEPARATOR, FileUtils.readFileToString(file, Charset.defaultCharset()));\n     }\n \n     @Test\n@@ -1766,7 +1779,7 @@ public class CSVPrinterTest {\n         try (CSVPrinter printer = CSVFormat.DEFAULT.print(file, Charset.defaultCharset())) {\n             printer.printRecord(\"a\", \"b\\\\c\");\n         }\n-        assertEquals(\"a,b\\\\c\" + recordSeparator, new String(Files.readAllBytes(file), Charset.defaultCharset()));\n+        assertEquals(\"a,b\\\\c\" + RECORD_SEPARATOR, new String(Files.readAllBytes(file), Charset.defaultCharset()));\n     }\n \n     @Test\n@@ -1774,7 +1787,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT.withQuoteMode(QuoteMode.ALL))) {\n             printer.printRecord(\"a\", \"b\\nc\", \"d\");\n-            assertEquals(\"\\\"a\\\",\\\"b\\nc\\\",\\\"d\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a\\\",\\\"b\\nc\\\",\\\"d\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1783,7 +1796,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.RFC4180)) {\n             printer.printRecord(\",\");\n-            assertEquals(\"\\\",\\\"\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\",\\\"\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1792,7 +1805,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT.withQuoteMode(QuoteMode.NON_NUMERIC))) {\n             printer.printRecord(\"a\", \"b\\nc\", Integer.valueOf(1));\n-            assertEquals(\"\\\"a\\\",\\\"b\\nc\\\",1\" + recordSeparator, sw.toString());\n+            assertEquals(\"\\\"a\\\",\\\"b\\nc\\\",1\" + RECORD_SEPARATOR, sw.toString());\n         }\n     }\n \n@@ -1849,7 +1862,7 @@ public class CSVPrinterTest {\n         final StringWriter sw = new StringWriter();\n         try (CSVPrinter printer = new CSVPrinter(sw, CSVFormat.DEFAULT.withCommentMarker('#'))) {\n             printer.printComment(\"This is a comment\");\n-            assertEquals(\"# This is a comment\" + recordSeparator, sw.toString());\n+            assertEquals(\"# This is a comment\" + RECORD_SEPARATOR, sw.toString());\n             assertEquals(0, printer.getRecordCount());\n         }\n     }",
    "stats": {
      "source_files": 3,
      "test_files": 1,
      "filtered": true
    }
  },
  "has_method_changes": true,
  "v1_execution": {
    "version": "v1",
    "commit_used": "c62d12a8ec5f987c3107674c03c8577fbbb70033",
    "build": {
      "success": true,
      "duration_seconds": 15.700157,
      "command": "mvn compile -DskipTests",
      "return_code": 0,
      "stdout": "",
      "stderr": ""
    },
    "test": {
      "success": true,
      "duration_seconds": 60.168283,
      "total_tests": 0,
      "passed": 0,
      "failed": 0,
      "skipped": 0,
      "errors": 0,
      "failed_tests": [],
      "error_tests": [],
      "return_code": -1,
      "stdout": "",
      "stderr": ""
    },
    "coverage": {
      "available": true,
      "jacoco_report_path": "/tmp/tubench_analysis_worktrees/commons-csv_441923/commons-csv_c62d12a8_v1_20260123_145947_081797/target/site/jacoco/jacoco.xml",
      "method_coverage": {
        "total_methods": 8,
        "covered_methods": 5,
        "coverage_ratio": 0.625,
        "details": [
          {
            "method": "org.apache.commons.csv.Builder.setLenientEof",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.Builder.setMaxRows",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.Builder.setTrailingDelimiter",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.append",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.getLenientEof",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.getMaxRows",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.hashCode",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVPrinter.printRecords",
            "covered": true
          }
        ]
      },
      "line_coverage": 0.9941956882255389,
      "covered_lines": 1199,
      "total_lines": 1206
    },
    "worktree_path": "/tmp/tubench_analysis_worktrees/commons-csv_441923/commons-csv_c62d12a8_v1_20260123_145947_081797"
  },
  "v05_execution": {
    "version": "v05",
    "commit_used": "c62d12a8ec5f987c3107674c03c8577fbbb70033",
    "build": {
      "success": true,
      "duration_seconds": 15.718957,
      "command": "mvn compile -DskipTests",
      "return_code": 0,
      "stdout": "",
      "stderr": ""
    },
    "test": {
      "success": true,
      "duration_seconds": 59.529767,
      "total_tests": 0,
      "passed": 0,
      "failed": 0,
      "skipped": 0,
      "errors": 0,
      "failed_tests": [],
      "error_tests": [],
      "return_code": -1,
      "stdout": "",
      "stderr": ""
    },
    "coverage": {
      "available": true,
      "jacoco_report_path": "/tmp/tubench_analysis_worktrees/commons-csv_441923/commons-csv_c62d12a8_v05_20260123_145947_082707/target/site/jacoco/jacoco.xml",
      "method_coverage": {
        "total_methods": 8,
        "covered_methods": 5,
        "coverage_ratio": 0.625,
        "details": [
          {
            "method": "org.apache.commons.csv.Builder.setLenientEof",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.Builder.setMaxRows",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.Builder.setTrailingDelimiter",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.append",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.getLenientEof",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.getMaxRows",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.hashCode",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVPrinter.printRecords",
            "covered": true
          }
        ]
      },
      "line_coverage": 0.9925681255161024,
      "covered_lines": 1202,
      "total_lines": 1211
    },
    "worktree_path": "/tmp/tubench_analysis_worktrees/commons-csv_441923/commons-csv_c62d12a8_v05_20260123_145947_082707",
    "patch_applied": true
  },
  "t05_execution": {
    "version": "t05",
    "commit_used": "c62d12a8ec5f987c3107674c03c8577fbbb70033",
    "build": {
      "success": true,
      "duration_seconds": 15.642605,
      "command": "mvn compile -DskipTests",
      "return_code": 0,
      "stdout": "",
      "stderr": ""
    },
    "test": {
      "success": true,
      "duration_seconds": 59.673547,
      "total_tests": 0,
      "passed": 0,
      "failed": 0,
      "skipped": 0,
      "errors": 0,
      "failed_tests": [],
      "error_tests": [],
      "return_code": -1,
      "stdout": "",
      "stderr": ""
    },
    "coverage": {
      "available": true,
      "jacoco_report_path": "/tmp/tubench_analysis_worktrees/commons-csv_441923/commons-csv_c62d12a8_t05_20260123_145947_087183/target/site/jacoco/jacoco.xml",
      "method_coverage": {
        "total_methods": 8,
        "covered_methods": 5,
        "coverage_ratio": 0.625,
        "details": [
          {
            "method": "org.apache.commons.csv.Builder.setLenientEof",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.Builder.setMaxRows",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.Builder.setTrailingDelimiter",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.append",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.getLenientEof",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.getMaxRows",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.hashCode",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVPrinter.printRecords",
            "covered": true
          }
        ]
      },
      "line_coverage": 0.9941956882255389,
      "covered_lines": 1199,
      "total_lines": 1206
    },
    "worktree_path": "/tmp/tubench_analysis_worktrees/commons-csv_441923/commons-csv_c62d12a8_t05_20260123_145947_087183",
    "patch_applied": true
  },
  "v0_execution": {
    "version": "v0",
    "commit_used": "30f0e1d6cafb2f6bec24b82493d850e5ae787173",
    "build": {
      "success": true,
      "duration_seconds": 15.319518,
      "command": "mvn compile -DskipTests",
      "return_code": 0,
      "stdout": "",
      "stderr": ""
    },
    "test": {
      "success": true,
      "duration_seconds": 60.037048,
      "total_tests": 0,
      "passed": 0,
      "failed": 0,
      "skipped": 0,
      "errors": 0,
      "failed_tests": [],
      "error_tests": [],
      "return_code": -1,
      "stdout": "",
      "stderr": ""
    },
    "coverage": {
      "available": true,
      "jacoco_report_path": "/tmp/tubench_analysis_worktrees/commons-csv_441923/commons-csv_30f0e1d6_v0_20260123_145947_090153/target/site/jacoco/jacoco.xml",
      "method_coverage": {
        "total_methods": 8,
        "covered_methods": 5,
        "coverage_ratio": 0.625,
        "details": [
          {
            "method": "org.apache.commons.csv.Builder.setLenientEof",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.Builder.setMaxRows",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.Builder.setTrailingDelimiter",
            "covered": false
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.append",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.getLenientEof",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.getMaxRows",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVFormat.hashCode",
            "covered": true
          },
          {
            "method": "org.apache.commons.csv.CSVPrinter.printRecords",
            "covered": true
          }
        ]
      },
      "line_coverage": 0.9942196531791907,
      "covered_lines": 1204,
      "total_lines": 1211
    },
    "worktree_path": "/tmp/tubench_analysis_worktrees/commons-csv_441923/commons-csv_30f0e1d6_v0_20260123_145947_090153"
  },
  "classification": {
    "scenario": "D",
    "scenario_description": "V-0.5T-0.5",
    "type1_execution_error": {
      "detected": false,
      "subtype": null,
      "confidence": null,
      "evidence": {}
    },
    "type2_coverage_decrease": {
      "detected": false,
      "confidence": null,
      "evidence": {}
    },
    "type3_adaptive_change": {
      "detected": true,
      "confidence": "high",
      "evidence": {
        "reason": "Type1Type2",
        "scenario": "D",
        "scenario_meaning": ""
      }
    },
    "all_types": [
      "type3_adaptive_change"
    ],
    "primary_type": "type3_adaptive_change",
    "types_count": 1
  },
  "qualified": true,
  "analysis_timestamp": "2026-01-23T15:01:03.190806"
}